{"ast":null,"code":"import _classCallCheck from \"/Users/lordokami/lordokami/lost-my-keys-vr/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/lordokami/lordokami/lost-my-keys-vr/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"/Users/lordokami/lordokami/lost-my-keys-vr/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/lordokami/lordokami/lost-my-keys-vr/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _defineProperty from \"/Users/lordokami/lordokami/lost-my-keys-vr/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _construct from \"/Users/lordokami/lordokami/lost-my-keys-vr/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/construct.js\";\nimport _toArray from \"/Users/lordokami/lordokami/lost-my-keys-vr/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toArray.js\";\nimport _slicedToArray from \"/Users/lordokami/lordokami/lost-my-keys-vr/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _objectWithoutProperties from \"/Users/lordokami/lordokami/lost-my-keys-vr/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";\nimport _toConsumableArray from \"/Users/lordokami/lordokami/lost-my-keys-vr/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _objectSpread from \"/Users/lordokami/lordokami/lost-my-keys-vr/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _createForOfIteratorHelper from \"/Users/lordokami/lordokami/lost-my-keys-vr/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nvar _excluded = [\"children\", \"key\", \"ref\"],\n    _excluded2 = [\"children\", \"key\", \"ref\"],\n    _excluded3 = [\"args\"],\n    _excluded4 = [\"args\", \"children\"],\n    _excluded5 = [\"args\", \"children\"],\n    _excluded6 = [\"params\"],\n    _excluded7 = [\"children\", \"fallback\", \"tabIndex\", \"resize\", \"id\", \"style\", \"className\", \"events\"],\n    _excluded8 = [\"gl\", \"size\", \"mode\", \"events\", \"onCreated\"];\nimport * as THREE from 'three';\nimport * as React from 'react';\nimport create from 'zustand';\nimport shallow from 'zustand/shallow';\nimport Reconciler from 'react-reconciler';\nimport { unstable_now, unstable_runWithPriority, unstable_IdlePriority } from 'scheduler';\nimport { useAsset } from 'use-asset';\nimport mergeRefs from 'react-merge-refs';\nimport useMeasure from 'react-use-measure';\nvar threeTypes = /*#__PURE__*/Object.freeze({\n  __proto__: null\n});\nvar is = {\n  obj: function obj(a) {\n    return a === Object(a) && !is.arr(a) && typeof a !== 'function';\n  },\n  fun: function fun(a) {\n    return typeof a === 'function';\n  },\n  str: function str(a) {\n    return typeof a === 'string';\n  },\n  num: function num(a) {\n    return typeof a === 'number';\n  },\n  und: function und(a) {\n    return a === void 0;\n  },\n  arr: function arr(a) {\n    return Array.isArray(a);\n  },\n  equ: function equ(a, b) {\n    // Wrong type or one of the two undefined, doesn't match\n    if (typeof a !== typeof b || !!a !== !!b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    var i;\n\n    for (i in a) {\n      if (!(i in b)) return false;\n    }\n\n    for (i in b) {\n      if (a[i] !== b[i]) return false;\n    }\n\n    return is.und(i) ? a === b : true;\n  }\n};\n\nfunction makeId(event) {\n  return (event.eventObject || event.object).uuid + '/' + event.index + event.instanceId;\n}\n\nfunction removeInteractivity(store, object) {\n  var _store$getState = store.getState(),\n      internal = _store$getState.internal; // Removes every trace of an object from the data store\n\n\n  internal.interaction = internal.interaction.filter(function (o) {\n    return o !== object;\n  });\n  internal.initialHits = internal.initialHits.filter(function (o) {\n    return o !== object;\n  });\n  internal.hovered.forEach(function (value, key) {\n    if (value.eventObject === object || value.object === object) {\n      internal.hovered.delete(key);\n    }\n  });\n}\n\nfunction createEvents(store) {\n  var temp = new THREE.Vector3();\n  /** Sets up defaultRaycaster */\n\n  function prepareRay(event) {\n    var _raycaster$computeOff;\n\n    var state = store.getState();\n    var raycaster = state.raycaster,\n        mouse = state.mouse,\n        camera = state.camera,\n        size = state.size; // https://github.com/pmndrs/react-three-fiber/pull/782\n    // Events trigger outside of canvas when moved\n\n    var _ref2 = (_raycaster$computeOff = raycaster.computeOffsets == null ? void 0 : raycaster.computeOffsets(event, state)) != null ? _raycaster$computeOff : event,\n        offsetX = _ref2.offsetX,\n        offsetY = _ref2.offsetY;\n\n    var width = size.width,\n        height = size.height;\n    mouse.set(offsetX / width * 2 - 1, -(offsetY / height) * 2 + 1);\n    raycaster.setFromCamera(mouse, camera);\n  }\n  /** Calculates delta */\n\n\n  function calculateDistance(event) {\n    var _store$getState2 = store.getState(),\n        internal = _store$getState2.internal;\n\n    var dx = event.offsetX - internal.initialClick[0];\n    var dy = event.offsetY - internal.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }\n  /** Returns true if an instance has a valid pointer-event registered, this excludes scroll, clicks etc */\n\n\n  function filterPointerEvents(objects) {\n    return objects.filter(function (obj) {\n      return ['Move', 'Over', 'Enter', 'Out', 'Leave'].some(function (name) {\n        var _r3f;\n\n        return (_r3f = obj.__r3f) == null ? void 0 : _r3f.handlers['onPointer' + name];\n      });\n    });\n  }\n\n  function intersect(filter) {\n    var state = store.getState();\n    var raycaster = state.raycaster,\n        internal = state.internal; // Skip event handling when noEvents is set\n\n    if (!raycaster.enabled) return [];\n    var seen = new Set();\n    var intersections = []; // Allow callers to eliminate event objects\n\n    var eventsObjects = filter ? filter(internal.interaction) : internal.interaction; // Intersect known handler objects and filter against duplicates\n\n    var intersects = raycaster.intersectObjects(eventsObjects, true).filter(function (item) {\n      var id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // https://github.com/mrdoob/three.js/issues/16031\n    // Allow custom userland intersect sort order\n\n    if (raycaster.filter) intersects = raycaster.filter(intersects, state);\n\n    var _iterator = _createForOfIteratorHelper(intersects),\n        _step;\n\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        var _intersect = _step.value;\n        var eventObject = _intersect.object; // Bubble event up\n\n        while (eventObject) {\n          var _r3f2;\n\n          if ((_r3f2 = eventObject.__r3f) != null && _r3f2.eventCount) intersections.push(_objectSpread(_objectSpread({}, _intersect), {}, {\n            eventObject: eventObject\n          }));\n          eventObject = eventObject.parent;\n        }\n      }\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n\n    return intersections;\n  }\n  /**  Creates filtered intersects and returns an array of positive hits */\n\n\n  function patchIntersects(intersections, event) {\n    var _store$getState3 = store.getState(),\n        internal = _store$getState3.internal; // If the interaction is captured, make all capturing targets  part of the\n    // intersect.\n\n\n    if ('pointerId' in event && internal.capturedMap.has(event.pointerId)) {\n      intersections.push.apply(intersections, _toConsumableArray(internal.capturedMap.get(event.pointerId).values()));\n    }\n\n    return intersections;\n  }\n  /**  Handles intersections by forwarding them to handlers */\n\n\n  function handleIntersects(intersections, event, delta, callback) {\n    var _store$getState4 = store.getState(),\n        raycaster = _store$getState4.raycaster,\n        mouse = _store$getState4.mouse,\n        camera = _store$getState4.camera,\n        internal = _store$getState4.internal; // If anything has been found, forward it to the event listeners\n\n\n    if (intersections.length) {\n      (function () {\n        var unprojectedPoint = temp.set(mouse.x, mouse.y, 0).unproject(camera);\n\n        var releasePointerCapture = function releasePointerCapture(id) {\n          return event.target.releasePointerCapture(id);\n        };\n\n        var localState = {\n          stopped: false\n        };\n\n        var _iterator2 = _createForOfIteratorHelper(intersections),\n            _step2;\n\n        try {\n          var _loop = function _loop() {\n            var hit = _step2.value;\n\n            var hasPointerCapture = function hasPointerCapture(id) {\n              var _internal$capturedMap, _internal$capturedMap2;\n\n              return (_internal$capturedMap = (_internal$capturedMap2 = internal.capturedMap.get(id)) == null ? void 0 : _internal$capturedMap2.has(hit.eventObject)) != null ? _internal$capturedMap : false;\n            };\n\n            var setPointerCapture = function setPointerCapture(id) {\n              if (internal.capturedMap.has(id)) {\n                // if the pointerId was previously captured, we add the hit to the\n                // event capturedMap.\n                internal.capturedMap.get(id).set(hit.eventObject, hit);\n              } else {\n                // if the pointerId was not previously captured, we create a map\n                // containing the hitObject, and the hit. hitObject is used for\n                // faster access.\n                internal.capturedMap.set(id, new Map([[hit.eventObject, hit]]));\n              } // Call the original event now\n\n\n              event.target.setPointerCapture(id);\n            }; // Add native event props\n\n\n            var extractEventProps = {};\n\n            for (var prop in Object.getPrototypeOf(event)) {\n              var property = event[prop]; // Only copy over atomics, leave functions alone as these should be\n              // called as event.nativeEvent.fn()\n\n              if (typeof property !== 'function') extractEventProps[prop] = property;\n            }\n\n            var raycastEvent = _objectSpread(_objectSpread(_objectSpread({}, hit), extractEventProps), {}, {\n              spaceX: mouse.x,\n              spaceY: mouse.y,\n              intersections: intersections,\n              stopped: localState.stopped,\n              delta: delta,\n              unprojectedPoint: unprojectedPoint,\n              ray: raycaster.ray,\n              camera: camera,\n              // Hijack stopPropagation, which just sets a flag\n              stopPropagation: function stopPropagation() {\n                // https://github.com/pmndrs/react-three-fiber/issues/596\n                // Events are not allowed to stop propagation if the pointer has been captured\n                var capturesForPointer = 'pointerId' in event && internal.capturedMap.get(event.pointerId); // We only authorize stopPropagation...\n\n                if ( // ...if this pointer hasn't been captured\n                !capturesForPointer || // ... or if the hit object is capturing the pointer\n                capturesForPointer.has(hit.eventObject)) {\n                  raycastEvent.stopped = localState.stopped = true; // Propagation is stopped, remove all other hover records\n                  // An event handler is only allowed to flush other handlers if it is hovered itself\n\n                  if (internal.hovered.size && Array.from(internal.hovered.values()).find(function (i) {\n                    return i.eventObject === hit.eventObject;\n                  })) {\n                    // Objects cannot flush out higher up objects that have already caught the event\n                    var higher = intersections.slice(0, intersections.indexOf(hit));\n                    cancelPointer([].concat(_toConsumableArray(higher), [hit]));\n                  }\n                }\n              },\n              // there should be a distinction between target and currentTarget\n              target: {\n                hasPointerCapture: hasPointerCapture,\n                setPointerCapture: setPointerCapture,\n                releasePointerCapture: releasePointerCapture\n              },\n              currentTarget: {\n                hasPointerCapture: hasPointerCapture,\n                setPointerCapture: setPointerCapture,\n                releasePointerCapture: releasePointerCapture\n              },\n              sourceEvent: event,\n              // deprecated\n              nativeEvent: event\n            }); // Call subscribers\n\n\n            callback(raycastEvent); // Event bubbling may be interrupted by stopPropagation\n\n            if (localState.stopped === true) return \"break\";\n          };\n\n          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n            var _ret = _loop();\n\n            if (_ret === \"break\") break;\n          }\n        } catch (err) {\n          _iterator2.e(err);\n        } finally {\n          _iterator2.f();\n        }\n      })();\n    }\n\n    return intersections;\n  }\n\n  function cancelPointer(hits) {\n    var _store$getState5 = store.getState(),\n        internal = _store$getState5.internal;\n\n    Array.from(internal.hovered.values()).forEach(function (hoveredObj) {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (!hits.length || !hits.find(function (hit) {\n        return hit.object === hoveredObj.object && hit.index === hoveredObj.index && hit.instanceId === hoveredObj.instanceId;\n      })) {\n        var eventObject = hoveredObj.eventObject;\n        var instance = eventObject.__r3f;\n        var handlers = instance == null ? void 0 : instance.handlers;\n        internal.hovered.delete(makeId(hoveredObj));\n\n        if (instance != null && instance.eventCount) {\n          // Clear out intersects, they are outdated by now\n          var data = _objectSpread(_objectSpread({}, hoveredObj), {}, {\n            intersections: hits || []\n          });\n\n          handlers.onPointerOut == null ? void 0 : handlers.onPointerOut(data);\n          handlers.onPointerLeave == null ? void 0 : handlers.onPointerLeave(data);\n        }\n      }\n    });\n  }\n\n  var handlePointer = function handlePointer(name) {\n    // Deal with cancelation\n    switch (name) {\n      case 'onPointerLeave':\n      case 'onPointerCancel':\n        return function () {\n          return cancelPointer([]);\n        };\n\n      case 'onLostPointerCapture':\n        return function (event) {\n          if ('pointerId' in event) {\n            // this will be a problem if one target releases the pointerId\n            // and another one is still keeping it, as the line below\n            // indifferently deletes all capturing references.\n            store.getState().internal.capturedMap.delete(event.pointerId);\n          }\n\n          cancelPointer([]);\n        };\n    } // Any other pointer goes here ...\n\n\n    return function (event) {\n      var _store$getState6 = store.getState(),\n          onPointerMissed = _store$getState6.onPointerMissed,\n          internal = _store$getState6.internal;\n\n      prepareRay(event); // Get fresh intersects\n\n      var isPointerMove = name === 'onPointerMove';\n      var isClickEvent = name === 'onClick' || name === 'onContextMenu' || name === 'onDoubleClick';\n      var filter = isPointerMove ? filterPointerEvents : undefined;\n      var hits = patchIntersects(intersect(filter), event);\n      var delta = isClickEvent ? calculateDistance(event) : 0; // Save initial coordinates on pointer-down\n\n      if (name === 'onPointerDown') {\n        internal.initialClick = [event.offsetX, event.offsetY];\n        internal.initialHits = hits.map(function (hit) {\n          return hit.eventObject;\n        });\n      } // If a click yields no results, pass it back to the user as a miss\n      // Missed events have to come first in order to establish user-land side-effect clean up\n\n\n      if (isClickEvent && !hits.length) {\n        if (delta <= 2) {\n          pointerMissed(event, internal.interaction);\n          if (onPointerMissed) onPointerMissed(event);\n        }\n      } // Take care of unhover\n\n\n      if (isPointerMove) cancelPointer(hits);\n      handleIntersects(hits, event, delta, function (data) {\n        var eventObject = data.eventObject;\n        var instance = eventObject.__r3f;\n        var handlers = instance == null ? void 0 : instance.handlers; // Check presence of handlers\n\n        if (!(instance != null && instance.eventCount)) return;\n\n        if (isPointerMove) {\n          // Move event ...\n          if (handlers.onPointerOver || handlers.onPointerEnter || handlers.onPointerOut || handlers.onPointerLeave) {\n            // When enter or out is present take care of hover-state\n            var id = makeId(data);\n            var hoveredItem = internal.hovered.get(id);\n\n            if (!hoveredItem) {\n              // If the object wasn't previously hovered, book it and call its handler\n              internal.hovered.set(id, data);\n              handlers.onPointerOver == null ? void 0 : handlers.onPointerOver(data);\n              handlers.onPointerEnter == null ? void 0 : handlers.onPointerEnter(data);\n            } else if (hoveredItem.stopped) {\n              // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n              data.stopPropagation();\n            }\n          } // Call mouse move\n\n\n          handlers.onPointerMove == null ? void 0 : handlers.onPointerMove(data);\n        } else {\n          // All other events ...\n          var handler = handlers[name];\n\n          if (handler) {\n            // Forward all events back to their respective handlers with the exception of click events,\n            // which must use the initial target\n            if (name !== 'onClick' && name !== 'onContextMenu' && name !== 'onDoubleClick' || internal.initialHits.includes(eventObject)) {\n              // Missed events have to come first\n              pointerMissed(event, internal.interaction.filter(function (object) {\n                return !internal.initialHits.includes(object);\n              })); // Now call the handler\n\n              handler(data);\n            }\n          }\n        }\n      });\n    };\n  };\n\n  function pointerMissed(event, objects) {\n    objects.forEach(function (object) {\n      var _r3f3;\n\n      return (_r3f3 = object.__r3f) == null ? void 0 : _r3f3.handlers.onPointerMissed == null ? void 0 : _r3f3.handlers.onPointerMissed(event);\n    });\n  }\n\n  return {\n    handlePointer: handlePointer\n  };\n}\n\nvar isDiffSet = function isDiffSet(def) {\n  return def && !!def.memoized && !!def.changes;\n}; // Type guard to tell a store from a portal\n\n\nvar isStore = function isStore(def) {\n  return def && !!def.getState;\n};\n\nvar getContainer = function getContainer(container, child) {\n  var _container$__r3f$root, _container$__r3f;\n\n  return {\n    // If the container is not a root-store then it must be a THREE.Object3D into which part of the\n    // scene is portalled into. Now there can be two variants of this, either that object is part of\n    // the regular jsx tree, in which case it already has __r3f with a valid root attached, or it lies\n    // outside react, in which case we must take the root of the child that is about to be attached to it.\n    root: isStore(container) ? container : (_container$__r3f$root = (_container$__r3f = container.__r3f) == null ? void 0 : _container$__r3f.root) != null ? _container$__r3f$root : child.__r3f.root,\n    // The container is the eventual target into which objects are mounted, it has to be a THREE.Object3D\n    container: isStore(container) ? container.getState().scene : container\n  };\n};\n\nvar DEFAULT = '__default';\nvar EMPTY = {};\nvar catalogue = {};\n\nvar extend = function extend(objects) {\n  return void (catalogue = _objectSpread(_objectSpread({}, catalogue), objects));\n}; // Shallow check arrays, but check objects atomically\n\n\nfunction checkShallow(a, b) {\n  if (is.arr(a) && is.equ(a, b)) return true;\n  if (a === b) return true;\n  return false;\n} // Each object in the scene carries a small LocalState descriptor\n\n\nfunction prepare(object, state) {\n  var instance = object;\n\n  if (state != null && state.primitive || !instance.__r3f) {\n    instance.__r3f = _objectSpread({\n      root: null,\n      memoizedProps: {},\n      eventCount: 0,\n      handlers: {},\n      objects: [],\n      parent: null\n    }, state);\n  }\n\n  return object;\n}\n\nfunction createRenderer(roots) {\n  // This function prepares a set of changes to be applied to the instance\n  function diffProps(instance, _ref3) {\n    var cN = _ref3.children,\n        kN = _ref3.key,\n        rN = _ref3.ref,\n        props = _objectWithoutProperties(_ref3, _excluded);\n\n    var _ref4 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n        cP = _ref4.children,\n        kP = _ref4.key,\n        rP = _ref4.ref,\n        previous = _objectWithoutProperties(_ref4, _excluded2);\n\n    var accumulative = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n\n    var _instance$__r3f;\n\n    var localState = (_instance$__r3f = instance == null ? void 0 : instance.__r3f) != null ? _instance$__r3f : {};\n    var entries = Object.entries(props);\n    var changes = []; // Catch removed props, prepend them so they can be reset or removed\n\n    if (accumulative) {\n      var previousKeys = Object.keys(previous);\n\n      for (var _i = 0; _i < previousKeys.length; _i++) {\n        if (!props.hasOwnProperty(previousKeys[_i])) entries.unshift([previousKeys[_i], DEFAULT + 'remove']);\n      }\n    }\n\n    entries.forEach(function (_ref5) {\n      var _ref6 = _slicedToArray(_ref5, 2),\n          key = _ref6[0],\n          value = _ref6[1];\n\n      var _instance$__r3f2; // Bail out on primitive object\n\n\n      if ((_instance$__r3f2 = instance.__r3f) != null && _instance$__r3f2.primitive && key === 'object') return; // When props match bail out\n\n      if (checkShallow(value, previous[key])) return; // Collect handlers and bail out\n\n      if (/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(key)) return changes.push([key, value, true, []]); // Split dashed props\n\n      var entries = [];\n      if (key.includes('-')) entries = key.split('-');\n      changes.push([key, value, false, entries]);\n    });\n\n    var memoized = _objectSpread({}, props);\n\n    if (localState.memoizedProps && localState.memoizedProps.args) memoized.args = localState.memoizedProps.args;\n    if (localState.memoizedProps && localState.memoizedProps.attach) memoized.attach = localState.memoizedProps.attach;\n    return {\n      accumulative: accumulative,\n      memoized: memoized,\n      changes: changes\n    };\n  }\n\n  function applyProps(instance, data) {\n    var _instance$__r3f3, _root$getState, _instance$__r3f4; // Filter equals, events and reserved props\n\n\n    var localState = (_instance$__r3f3 = instance == null ? void 0 : instance.__r3f) != null ? _instance$__r3f3 : {};\n    var root = localState.root;\n    var rootState = (_root$getState = root == null ? void 0 : root.getState == null ? void 0 : root.getState()) != null ? _root$getState : {};\n\n    var _ref7 = isDiffSet(data) ? data : diffProps(instance, data),\n        memoized = _ref7.memoized,\n        changes = _ref7.changes;\n\n    var prevHandlers = localState.eventCount; // Prepare memoized props\n\n    if (instance.__r3f) instance.__r3f.memoizedProps = memoized;\n    changes.forEach(function (_ref8) {\n      var _ref9 = _slicedToArray(_ref8, 4),\n          key = _ref9[0],\n          value = _ref9[1],\n          isEvent = _ref9[2],\n          keys = _ref9[3];\n\n      var currentInstance = instance;\n      var targetProp = currentInstance[key]; // Revolve dashed props\n\n      if (keys.length) {\n        targetProp = keys.reduce(function (acc, key) {\n          return acc[key];\n        }, instance); // If the target is atomic, it forces us to switch the root\n\n        if (!(targetProp && targetProp.set)) {\n          var _keys$reverse = keys.reverse(),\n              _keys$reverse2 = _toArray(_keys$reverse),\n              name = _keys$reverse2[0],\n              reverseEntries = _keys$reverse2.slice(1);\n\n          currentInstance = reverseEntries.reverse().reduce(function (acc, key) {\n            return acc[key];\n          }, instance);\n          key = name;\n        }\n      } // https://github.com/mrdoob/three.js/issues/21209\n      // HMR/fast-refresh relies on the ability to cancel out props, but threejs\n      // has no means to do this. Hence we curate a small collection of value-classes\n      // with their respective constructor/set arguments\n      // For removed props, try to set default values, if possible\n\n\n      if (value === DEFAULT + 'remove') {\n        if (targetProp && targetProp.constructor) {\n          // use the prop constructor to find the default it should be\n          value = new targetProp.constructor(memoized.args);\n        } else if (currentInstance.constructor) {\n          // create a blank slate of the instance and copy the particular parameter.\n          // @ts-ignore\n          var defaultClassCall = new currentInstance.constructor(currentInstance.__r3f.memoizedProps.args);\n          value = defaultClassCall[targetProp]; // destory the instance\n\n          if (defaultClassCall.dispose) defaultClassCall.dispose(); // instance does not have constructor, just set it to 0\n        } else value = 0;\n      } // Deal with pointer events ...\n\n\n      if (isEvent) {\n        if (value) localState.handlers[key] = value;else delete localState.handlers[key];\n        localState.eventCount = Object.keys(localState.handlers).length;\n      } // Special treatment for objects with support for set/copy, and layers\n      else if (targetProp && targetProp.set && (targetProp.copy || targetProp instanceof THREE.Layers)) {\n        // If value is an array\n        if (Array.isArray(value)) {\n          var _targetProp;\n\n          if (targetProp.fromArray) targetProp.fromArray(value);else (_targetProp = targetProp).set.apply(_targetProp, _toConsumableArray(value));\n        } // Test again target.copy(class) next ...\n        else if (targetProp.copy && value && value.constructor && targetProp.constructor.name === value.constructor.name) targetProp.copy(value); // If nothing else fits, just set the single value, ignore undefined\n        // https://github.com/react-spring/react-three-fiber/issues/274\n        else if (value !== undefined) {\n          var isColor = targetProp instanceof THREE.Color; // Allow setting array scalars\n\n          if (!isColor && targetProp.setScalar) targetProp.setScalar(value); // Layers have no copy function, we must therefore copy the mask property\n          else if (targetProp instanceof THREE.Layers && value instanceof THREE.Layers) targetProp.mask = value.mask; // Otherwise just set ...\n          else targetProp.set(value); // Auto-convert sRGB colors, for now ...\n          // https://github.com/react-spring/react-three-fiber/issues/344\n\n          if (!rootState.linear && isColor) targetProp.convertSRGBToLinear();\n        } // Else, just overwrite the value\n\n      } else {\n        currentInstance[key] = value; // Auto-convert sRGB textures, for now ...\n        // https://github.com/react-spring/react-three-fiber/issues/344\n\n        if (!rootState.linear && currentInstance[key] instanceof THREE.Texture) currentInstance[key].encoding = THREE.sRGBEncoding;\n      }\n\n      invalidateInstance(instance);\n    });\n\n    if (rootState.internal && instance.raycast && prevHandlers !== localState.eventCount) {\n      // Pre-emptively remove the instance from the interaction manager\n      var index = rootState.internal.interaction.indexOf(instance);\n      if (index > -1) rootState.internal.interaction.splice(index, 1); // Add the instance to the interaction manager only when it has handlers\n\n      if (localState.eventCount) rootState.internal.interaction.push(instance);\n    } // Call the update lifecycle when it is being updated\n\n\n    if (changes.length && (_instance$__r3f4 = instance.__r3f) != null && _instance$__r3f4.parent) updateInstance(instance);\n    return instance;\n  }\n\n  function invalidateInstance(instance) {\n    var _instance$__r3f5, _instance$__r3f5$root;\n\n    var state = (_instance$__r3f5 = instance.__r3f) == null ? void 0 : (_instance$__r3f5$root = _instance$__r3f5.root) == null ? void 0 : _instance$__r3f5$root.getState == null ? void 0 : _instance$__r3f5$root.getState();\n    if (state && state.internal.frames === 0) state.invalidate();\n  }\n\n  function updateInstance(instance) {\n    instance.onUpdate == null ? void 0 : instance.onUpdate(instance);\n  }\n\n  function createInstance(type, _ref10, root, hostContext, internalInstanceHandle) {\n    var _ref10$args = _ref10.args,\n        args = _ref10$args === void 0 ? [] : _ref10$args,\n        props = _objectWithoutProperties(_ref10, _excluded3);\n\n    var name = \"\".concat(type[0].toUpperCase()).concat(type.slice(1));\n    var instance; // https://github.com/facebook/react/issues/17147\n    // Portals do not give us a root, they are themselves treated as a root by the reconciler\n    // In order to figure out the actual root we have to climb through fiber internals :(\n\n    if (!isStore(root) && internalInstanceHandle) {\n      var fn = function fn(node) {\n        if (!node.return) return node.stateNode && node.stateNode.containerInfo;else return fn(node.return);\n      };\n\n      root = fn(internalInstanceHandle);\n    } // Assert that by now we have a valid root\n\n\n    if (!root || !isStore(root)) throw \"No valid root for \".concat(name, \"!\");\n\n    if (type === 'primitive') {\n      if (props.object === undefined) throw \"Primitives without 'object' are invalid!\";\n      var object = props.object;\n      instance = prepare(object, {\n        root: root,\n        primitive: true\n      });\n    } else {\n      var target = catalogue[name] || THREE[name];\n      if (!target) throw \"\".concat(name, \" is not part of the THREE namespace! Did you forget to extend? See: https://github.com/pmndrs/react-three-fiber/blob/master/markdown/api.md#using-3rd-party-objects-declaratively\"); // Instanciate new object, link it to the root\n      // Append memoized props with args so it's not forgotten\n\n      instance = prepare(_construct(target, _toConsumableArray(args)), {\n        root: root,\n        memoizedProps: {\n          args: args.length === 0 ? null : args\n        }\n      });\n    } // Auto-attach geometries and materials\n\n\n    if (!('attachFns' in props)) {\n      if (name.endsWith('Geometry')) {\n        props = _objectSpread({\n          attach: 'geometry'\n        }, props);\n      } else if (name.endsWith('Material')) {\n        props = _objectSpread({\n          attach: 'material'\n        }, props);\n      }\n    } // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n    // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n    // why it passes \"true\" here\n\n\n    applyProps(instance, props);\n    return instance;\n  }\n\n  function appendChild(parentInstance, child) {\n    var addedAsChild = false;\n\n    if (child) {\n      // The attach attribute implies that the object attaches itself on the parent\n      if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      } else if (child.attach && !is.fun(child.attach)) {\n        parentInstance[child.attach] = child;\n      } else if (is.arr(child.attachFns)) {\n        var _child$attachFns = _slicedToArray(child.attachFns, 1),\n            attachFn = _child$attachFns[0];\n\n        if (is.str(attachFn) && is.fun(parentInstance[attachFn])) {\n          parentInstance[attachFn](child);\n        } else if (is.fun(attachFn)) {\n          attachFn(child, parentInstance);\n        }\n      } else if (child.isObject3D && parentInstance.isObject3D) {\n        // add in the usual parent-child way\n        parentInstance.add(child);\n        addedAsChild = true;\n      }\n\n      if (!addedAsChild) {\n        // This is for anything that used attach, and for non-Object3Ds that don't get attached to props;\n        // that is, anything that's a child in React but not a child in the scenegraph.\n        parentInstance.__r3f.objects.push(child);\n      }\n\n      if (!child.__r3f) {\n        prepare(child, {});\n      }\n\n      child.__r3f.parent = parentInstance;\n      updateInstance(child);\n      invalidateInstance(child);\n    }\n  }\n\n  function insertBefore(parentInstance, child, beforeChild) {\n    var added = false;\n\n    if (child) {\n      if (child.attachArray) {\n        var array = parentInstance[child.attachArray];\n        if (!is.arr(array)) parentInstance[child.attachArray] = [];\n        array.splice(array.indexOf(beforeChild), 0, child);\n      } else if (child.attachObject || child.attach && !is.fun(child.attach)) {\n        // attach and attachObject don't have an order anyway, so just append\n        return appendChild(parentInstance, child);\n      } else if (child.isObject3D && parentInstance.isObject3D) {\n        child.parent = parentInstance;\n        child.dispatchEvent({\n          type: 'added'\n        });\n        var restSiblings = parentInstance.children.filter(function (sibling) {\n          return sibling !== child;\n        });\n        var index = restSiblings.indexOf(beforeChild);\n        parentInstance.children = [].concat(_toConsumableArray(restSiblings.slice(0, index)), [child], _toConsumableArray(restSiblings.slice(index)));\n        added = true;\n      }\n\n      if (!added) {\n        parentInstance.__r3f.objects.push(child);\n      }\n\n      if (!child.__r3f) {\n        prepare(child, {});\n      }\n\n      child.__r3f.parent = parentInstance;\n      updateInstance(child);\n      invalidateInstance(child);\n    }\n  }\n\n  function removeRecursive(array, parent) {\n    var dispose = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    if (array) _toConsumableArray(array).forEach(function (child) {\n      return removeChild(parent, child, dispose);\n    });\n  }\n\n  function removeChild(parentInstance, child, dispose) {\n    if (child) {\n      var _parentInstance$__r3f, _child$__r3f2;\n\n      if (child.__r3f) {\n        child.__r3f.parent = null;\n      }\n\n      if ((_parentInstance$__r3f = parentInstance.__r3f) != null && _parentInstance$__r3f.objects) {\n        parentInstance.__r3f.objects = parentInstance.__r3f.objects.filter(function (x) {\n          return x !== child;\n        });\n      } // Remove attachment\n\n\n      if (child.attachArray) {\n        parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(function (x) {\n          return x !== child;\n        });\n      } else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      } else if (child.attach && !is.fun(child.attach)) {\n        parentInstance[child.attach] = null;\n      } else if (is.arr(child.attachFns)) {\n        var _child$attachFns2 = _slicedToArray(child.attachFns, 2),\n            detachFn = _child$attachFns2[1];\n\n        if (is.str(detachFn) && is.fun(parentInstance[detachFn])) {\n          parentInstance[detachFn](child);\n        } else if (is.fun(detachFn)) {\n          detachFn(child, parentInstance);\n        }\n      } else if (child.isObject3D) {\n        var _child$__r3f;\n\n        parentInstance.remove(child); // Remove interactivity\n\n        if ((_child$__r3f = child.__r3f) != null && _child$__r3f.root) {\n          removeInteractivity(child.__r3f.root, child);\n        }\n      } // Allow objects to bail out of recursive dispose alltogether by passing dispose={null}\n      // Never dispose of primitives because their state may be kept outside of React!\n      // In order for an object to be able to dispose it has to have\n      //   - a dispose method,\n      //   - it cannot be a <primitive object={...} />\n      //   - it cannot be a THREE.Scene, because three has broken it's own api\n      //\n      // Since disposal is recursive, we can check the optional dispose arg, which will be undefined\n      // when the reconciler calls it, but then carry our own check recursively\n\n\n      var isPrimitive = (_child$__r3f2 = child.__r3f) == null ? void 0 : _child$__r3f2.primitive;\n      var shouldDispose = dispose === undefined ? child.dispose !== null && !isPrimitive : dispose; // Remove nested child objects. Primitives should not have objects and children that are\n      // attached to them declaratively ...\n\n      if (!isPrimitive) {\n        var _child$__r3f3;\n\n        removeRecursive((_child$__r3f3 = child.__r3f) == null ? void 0 : _child$__r3f3.objects, child, shouldDispose);\n        removeRecursive(child.children, child, shouldDispose);\n      } // Remove references\n\n\n      if (child.__r3f) {\n        delete child.__r3f.root;\n        delete child.__r3f.objects;\n        delete child.__r3f.handlers;\n        delete child.__r3f.memoizedProps;\n        if (!isPrimitive) delete child.__r3f;\n      } // Dispose item whenever the reconciler feels like it\n\n\n      if (shouldDispose && child.dispose && child.type !== 'Scene') {\n        unstable_runWithPriority(unstable_IdlePriority, function () {\n          try {\n            child.dispose();\n          } catch (e) {\n            /* ... */\n          }\n        });\n      }\n\n      invalidateInstance(parentInstance);\n    }\n  }\n\n  function switchInstance(instance, type, newProps, fiber) {\n    var _instance$__r3f6;\n\n    var parent = (_instance$__r3f6 = instance.__r3f) == null ? void 0 : _instance$__r3f6.parent;\n    if (!parent) return;\n    var newInstance = createInstance(type, newProps, instance.__r3f.root); // https://github.com/pmndrs/react-three-fiber/issues/1348\n    // When args change the instance has to be re-constructed, which then\n    // forces r3f to re-parent the children and non-scene objects\n    // This can not include primitives, which should not have declarative children\n\n    if (type !== 'primitive' && instance.children) {\n      instance.children.forEach(function (child) {\n        return appendChild(newInstance, child);\n      });\n      instance.children = [];\n    }\n\n    instance.__r3f.objects.forEach(function (child) {\n      return appendChild(newInstance, child);\n    });\n\n    instance.__r3f.objects = [];\n    removeChild(parent, instance);\n    appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n    // https://github.com/facebook/react/issues/14983\n    // https://github.com/facebook/react/pull/15021\n    ;\n    [fiber, fiber.alternate].forEach(function (fiber) {\n      if (fiber !== null) {\n        fiber.stateNode = newInstance;\n\n        if (fiber.ref) {\n          if (typeof fiber.ref === 'function') fiber.ref(newInstance);else fiber.ref.current = newInstance;\n        }\n      }\n    });\n  }\n\n  var reconciler = Reconciler({\n    now: unstable_now,\n    createInstance: createInstance,\n    removeChild: removeChild,\n    appendChild: appendChild,\n    appendInitialChild: appendChild,\n    insertBefore: insertBefore,\n    warnsIfNotActing: true,\n    supportsMutation: true,\n    isPrimaryRenderer: false,\n    // @ts-ignore\n    scheduleTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n    // @ts-ignore\n    cancelTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n    // @ts-ignore\n    setTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n    // @ts-ignore\n    clearTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n    noTimeout: -1,\n    appendChildToContainer: function appendChildToContainer(parentInstance, child) {\n      var _getContainer = getContainer(parentInstance, child),\n          container = _getContainer.container,\n          root = _getContainer.root; // Link current root to the default scene\n\n\n      container.__r3f.root = root;\n      appendChild(container, child);\n    },\n    removeChildFromContainer: function removeChildFromContainer(parentInstance, child) {\n      return removeChild(getContainer(parentInstance, child).container, child);\n    },\n    insertInContainerBefore: function insertInContainerBefore(parentInstance, child, beforeChild) {\n      return insertBefore(getContainer(parentInstance, child).container, child, beforeChild);\n    },\n    prepareUpdate: function prepareUpdate(instance, type, oldProps, newProps) {\n      if (instance.__r3f.primitive && newProps.object && newProps.object !== instance) return [true];else {\n        // This is a data object, let's extract critical information about it\n        var _newProps$args = newProps.args,\n            argsNew = _newProps$args === void 0 ? [] : _newProps$args,\n            cN = newProps.children,\n            restNew = _objectWithoutProperties(newProps, _excluded4);\n\n        var _oldProps$args = oldProps.args,\n            argsOld = _oldProps$args === void 0 ? [] : _oldProps$args,\n            cO = oldProps.children,\n            restOld = _objectWithoutProperties(oldProps, _excluded5); // If it has new props or arguments, then it needs to be re-instanciated\n\n\n        if (argsNew.some(function (value, index) {\n          return value !== argsOld[index];\n        })) return [true]; // Create a diff-set, flag if there are any changes\n\n        var diff = diffProps(instance, restNew, restOld, true);\n        if (diff.changes.length) return [false, diff]; // Otherwise do not touch the instance\n\n        return null;\n      }\n    },\n    commitUpdate: function commitUpdate(instance, _ref11, type, oldProps, newProps, fiber) {\n      var _ref12 = _slicedToArray(_ref11, 2),\n          reconstruct = _ref12[0],\n          diff = _ref12[1];\n\n      // Reconstruct when args or <primitive object={...} have changes\n      if (reconstruct) switchInstance(instance, type, newProps, fiber); // Otherwise just overwrite props\n      else applyProps(instance, diff);\n    },\n    hideInstance: function hideInstance(instance) {\n      if (instance.isObject3D) {\n        instance.visible = false;\n        invalidateInstance(instance);\n      }\n    },\n    unhideInstance: function unhideInstance(instance, props) {\n      if (instance.isObject3D && props.visible == null || props.visible) {\n        instance.visible = true;\n        invalidateInstance(instance);\n      }\n    },\n    hideTextInstance: function hideTextInstance() {\n      throw new Error('Text is not allowed in the R3F tree.');\n    },\n    getPublicInstance: function getPublicInstance(instance) {\n      // TODO: might fix switchInstance (?)\n      return instance;\n    },\n    getRootHostContext: function getRootHostContext(rootContainer) {\n      return EMPTY;\n    },\n    getChildHostContext: function getChildHostContext(parentHostContext) {\n      return parentHostContext;\n    },\n    createTextInstance: function createTextInstance() {},\n    finalizeInitialChildren: function finalizeInitialChildren() {\n      return false;\n    },\n    commitMount: function commitMount() {// noop\n    },\n    shouldDeprioritizeSubtree: function shouldDeprioritizeSubtree() {\n      return false;\n    },\n    prepareForCommit: function prepareForCommit() {\n      return null;\n    },\n    preparePortalMount: function preparePortalMount(containerInfo) {\n      prepare(containerInfo);\n    },\n    resetAfterCommit: function resetAfterCommit() {// noop\n    },\n    shouldSetTextContent: function shouldSetTextContent() {\n      return false;\n    },\n    clearContainer: function clearContainer() {\n      return false;\n    }\n  });\n  return {\n    reconciler: reconciler,\n    applyProps: applyProps\n  };\n}\n\nvar isRenderer = function isRenderer(def) {\n  return !!(def != null && def.render);\n};\n\nvar isOrthographicCamera = function isOrthographicCamera(def) {\n  return def && def.isOrthographicCamera;\n};\n\nfunction calculateDpr(dpr) {\n  return Array.isArray(dpr) ? Math.min(Math.max(dpr[0], window.devicePixelRatio), dpr[1]) : dpr;\n}\n\nvar context = /*#__PURE__*/React.createContext(null);\n\nvar createStore = function createStore(applyProps, _invalidate, _advance, props) {\n  var gl = props.gl,\n      size = props.size,\n      _props$shadows = props.shadows,\n      shadows = _props$shadows === void 0 ? false : _props$shadows,\n      _props$linear = props.linear,\n      linear = _props$linear === void 0 ? false : _props$linear,\n      _props$flat = props.flat,\n      flat = _props$flat === void 0 ? false : _props$flat,\n      _props$vr = props.vr,\n      vr = _props$vr === void 0 ? false : _props$vr,\n      _props$orthographic = props.orthographic,\n      orthographic = _props$orthographic === void 0 ? false : _props$orthographic,\n      _props$frameloop = props.frameloop,\n      frameloop = _props$frameloop === void 0 ? 'always' : _props$frameloop,\n      _props$dpr = props.dpr,\n      dpr = _props$dpr === void 0 ? 1 : _props$dpr,\n      performance = props.performance,\n      _props$clock = props.clock,\n      clock = _props$clock === void 0 ? new THREE.Clock() : _props$clock,\n      raycastOptions = props.raycaster,\n      cameraOptions = props.camera,\n      onPointerMissed = props.onPointerMissed; // Set shadowmap\n\n  if (shadows) {\n    gl.shadowMap.enabled = true;\n    if (typeof shadows === 'object') Object.assign(gl.shadowMap, shadows);else gl.shadowMap.type = THREE.PCFSoftShadowMap;\n  } // Set color management\n\n\n  if (!linear) gl.outputEncoding = THREE.sRGBEncoding;\n  if (!flat) gl.toneMapping = THREE.ACESFilmicToneMapping; // clock.elapsedTime is updated using advance(timestamp)\n\n  if (frameloop === 'never') {\n    clock.stop();\n    clock.elapsedTime = 0;\n  }\n\n  var rootState = create(function (set, get) {\n    // Create custom raycaster\n    var raycaster = new THREE.Raycaster();\n\n    var _ref13 = raycastOptions || {},\n        params = _ref13.params,\n        options = _objectWithoutProperties(_ref13, _excluded6);\n\n    applyProps(raycaster, _objectSpread(_objectSpread({\n      enabled: true\n    }, options), {}, {\n      params: _objectSpread(_objectSpread({}, raycaster.params), params)\n    })); // Create default camera\n\n    var isCamera = cameraOptions instanceof THREE.Camera;\n    var camera = isCamera ? cameraOptions : orthographic ? new THREE.OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new THREE.PerspectiveCamera(75, 0, 0.1, 1000);\n\n    if (!isCamera) {\n      camera.position.z = 5;\n      if (cameraOptions) applyProps(camera, cameraOptions); // Always look at center by default\n\n      if (!(cameraOptions != null && cameraOptions.rotation)) camera.lookAt(0, 0, 0);\n    }\n\n    var initialDpr = calculateDpr(dpr);\n    var position = new THREE.Vector3();\n    var defaultTarget = new THREE.Vector3();\n    var tempTarget = new THREE.Vector3();\n\n    function getCurrentViewport() {\n      var camera = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : get().camera;\n      var target = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : defaultTarget;\n      var size = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : get().size;\n      var width = size.width,\n          height = size.height;\n      var aspect = width / height;\n      if (target instanceof THREE.Vector3) tempTarget.copy(target);else tempTarget.set.apply(tempTarget, _toConsumableArray(target));\n      var distance = camera.getWorldPosition(position).distanceTo(tempTarget);\n\n      if (isOrthographicCamera(camera)) {\n        return {\n          width: width / camera.zoom,\n          height: height / camera.zoom,\n          factor: 1,\n          distance: distance,\n          aspect: aspect\n        };\n      } else {\n        var fov = camera.fov * Math.PI / 180; // convert vertical fov to radians\n\n        var h = 2 * Math.tan(fov / 2) * distance; // visible height\n\n        var w = h * (width / height);\n        return {\n          width: w,\n          height: h,\n          factor: width / w,\n          distance: distance,\n          aspect: aspect\n        };\n      }\n    }\n\n    var performanceTimeout = undefined;\n\n    var setPerformanceCurrent = function setPerformanceCurrent(current) {\n      return set(function (state) {\n        return {\n          performance: _objectSpread(_objectSpread({}, state.performance), {}, {\n            current: current\n          })\n        };\n      });\n    };\n\n    return {\n      gl: gl,\n      set: set,\n      get: get,\n      invalidate: function invalidate() {\n        return _invalidate(get());\n      },\n      advance: function advance(timestamp, runGlobalEffects) {\n        return _advance(timestamp, runGlobalEffects, get());\n      },\n      linear: linear,\n      flat: flat,\n      scene: prepare(new THREE.Scene()),\n      camera: camera,\n      controls: null,\n      raycaster: raycaster,\n      clock: clock,\n      mouse: new THREE.Vector2(),\n      vr: vr,\n      frameloop: frameloop,\n      onPointerMissed: onPointerMissed,\n      performance: _objectSpread(_objectSpread({\n        current: 1,\n        min: 0.5,\n        max: 1,\n        debounce: 200\n      }, performance), {}, {\n        regress: function regress() {\n          var state = get(); // Clear timeout\n\n          if (performanceTimeout) clearTimeout(performanceTimeout); // Set lower bound performance\n\n          if (state.performance.current !== state.performance.min) setPerformanceCurrent(state.performance.min); // Go back to upper bound performance after a while unless something regresses meanwhile\n\n          performanceTimeout = setTimeout(function () {\n            return setPerformanceCurrent(get().performance.max);\n          }, state.performance.debounce);\n        }\n      }),\n      size: {\n        width: 0,\n        height: 0\n      },\n      viewport: {\n        initialDpr: initialDpr,\n        dpr: initialDpr,\n        width: 0,\n        height: 0,\n        aspect: 0,\n        distance: 0,\n        factor: 0,\n        getCurrentViewport: getCurrentViewport\n      },\n      setSize: function setSize(width, height) {\n        var size = {\n          width: width,\n          height: height\n        };\n        set(function (state) {\n          return {\n            size: size,\n            viewport: _objectSpread(_objectSpread({}, state.viewport), getCurrentViewport(camera, defaultTarget, size))\n          };\n        });\n      },\n      setDpr: function setDpr(dpr) {\n        return set(function (state) {\n          return {\n            viewport: _objectSpread(_objectSpread({}, state.viewport), {}, {\n              dpr: calculateDpr(dpr)\n            })\n          };\n        });\n      },\n      events: {\n        connected: false\n      },\n      internal: {\n        active: false,\n        priority: 0,\n        frames: 0,\n        lastProps: props,\n        interaction: [],\n        hovered: new Map(),\n        subscribers: [],\n        initialClick: [0, 0],\n        initialHits: [],\n        capturedMap: new Map(),\n        subscribe: function subscribe(ref) {\n          var priority = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n          set(function (_ref14) {\n            var internal = _ref14.internal;\n            return {\n              internal: _objectSpread(_objectSpread({}, internal), {}, {\n                // If this subscription was given a priority, it takes rendering into its own hands\n                // For that reason we switch off automatic rendering and increase the manual flag\n                // As long as this flag is positive there can be no internal rendering at all\n                // because there could be multiple render subscriptions\n                priority: internal.priority + (priority > 0 ? 1 : 0),\n                // Register subscriber and sort layers from lowest to highest, meaning,\n                // highest priority renders last (on top of the other frames)\n                subscribers: [].concat(_toConsumableArray(internal.subscribers), [{\n                  ref: ref,\n                  priority: priority\n                }]).sort(function (a, b) {\n                  return a.priority - b.priority;\n                })\n              })\n            };\n          });\n          return function () {\n            set(function (_ref15) {\n              var internal = _ref15.internal;\n              return {\n                internal: _objectSpread(_objectSpread({}, internal), {}, {\n                  // Decrease manual flag if this subscription had a priority\n                  priority: internal.priority - (priority > 0 ? 1 : 0),\n                  // Remove subscriber from list\n                  subscribers: internal.subscribers.filter(function (s) {\n                    return s.ref !== ref;\n                  })\n                })\n              };\n            });\n          };\n        }\n      }\n    };\n  }); // Resize camera and renderer on changes to size and pixelratio\n\n  rootState.subscribe(function () {\n    var _rootState$getState = rootState.getState(),\n        camera = _rootState$getState.camera,\n        size = _rootState$getState.size,\n        viewport = _rootState$getState.viewport,\n        internal = _rootState$getState.internal; // https://github.com/pmndrs/react-three-fiber/issues/92\n    // Do not mess with the camera if it belongs to the user\n\n\n    if (!(internal.lastProps.camera instanceof THREE.Camera)) {\n      if (isOrthographicCamera(camera)) {\n        camera.left = size.width / -2;\n        camera.right = size.width / 2;\n        camera.top = size.height / 2;\n        camera.bottom = size.height / -2;\n      } else {\n        camera.aspect = size.width / size.height;\n      }\n\n      camera.updateProjectionMatrix(); // https://github.com/pmndrs/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      camera.updateMatrixWorld();\n    } // Update renderer\n\n\n    gl.setPixelRatio(viewport.dpr);\n    gl.setSize(size.width, size.height);\n  }, function (state) {\n    return [state.viewport.dpr, state.size];\n  }, shallow);\n  var state = rootState.getState(); // Update size\n\n  if (size) state.setSize(size.width, size.height); // Invalidate on any change\n\n  rootState.subscribe(function (state) {\n    return _invalidate(state);\n  }); // Return root state\n\n  return rootState;\n};\n\nfunction createSubs(callback, subs) {\n  var index = subs.length;\n  subs.push(callback);\n  return function () {\n    return void subs.splice(index, 1);\n  };\n}\n\nvar i;\nvar globalEffects = [];\nvar globalAfterEffects = [];\nvar globalTailEffects = [];\n\nvar addEffect = function addEffect(callback) {\n  return createSubs(callback, globalEffects);\n};\n\nvar addAfterEffect = function addAfterEffect(callback) {\n  return createSubs(callback, globalAfterEffects);\n};\n\nvar addTail = function addTail(callback) {\n  return createSubs(callback, globalTailEffects);\n};\n\nfunction run(effects, timestamp) {\n  for (i = 0; i < effects.length; i++) {\n    effects[i](timestamp);\n  }\n}\n\nfunction render$1(timestamp, state) {\n  // Run local effects\n  var delta = state.clock.getDelta(); // In frameloop='never' mode, clock times are updated using the provided timestamp\n\n  if (state.frameloop === 'never' && typeof timestamp === 'number') {\n    delta = timestamp - state.clock.elapsedTime;\n    state.clock.oldTime = state.clock.elapsedTime;\n    state.clock.elapsedTime = timestamp;\n  } // Call subscribers (useFrame)\n\n\n  for (i = 0; i < state.internal.subscribers.length; i++) {\n    state.internal.subscribers[i].ref.current(state, delta);\n  } // Render content\n\n\n  if (!state.internal.priority && state.gl.render) state.gl.render(state.scene, state.camera); // Decrease frame count\n\n  state.internal.frames = Math.max(0, state.internal.frames - 1);\n  return state.frameloop === 'always' ? 1 : state.internal.frames;\n}\n\nfunction createLoop(roots) {\n  var running = false;\n  var repeat;\n\n  function loop(timestamp) {\n    running = true;\n    repeat = 0; // Run effects\n\n    run(globalEffects, timestamp); // Render all roots\n\n    roots.forEach(function (root) {\n      var state = root.store.getState(); // If the frameloop is invalidated, do not run another frame\n\n      if (state.internal.active && (state.frameloop === 'always' || state.internal.frames > 0)) repeat += render$1(timestamp, state);\n    }); // Run after-effects\n\n    run(globalAfterEffects, timestamp); // Keep on looping if anything invalidates the frameloop\n\n    if (repeat > 0) return requestAnimationFrame(loop); // Tail call effects, they are called when rendering stops\n    else run(globalTailEffects, timestamp); // Flag end of operation\n\n    running = false;\n  }\n\n  function invalidate(state) {\n    if (!state) return roots.forEach(function (root) {\n      return invalidate(root.store.getState());\n    });\n    if (state.vr || !state.internal.active || state.frameloop === 'never') return; // Increase frames, do not go higher than 60\n\n    state.internal.frames = Math.min(60, state.internal.frames + 1); // If the render-loop isn't active, start it\n\n    if (!running) {\n      running = true;\n      requestAnimationFrame(loop);\n    }\n  }\n\n  function advance(timestamp) {\n    var runGlobalEffects = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n    var state = arguments.length > 2 ? arguments[2] : undefined;\n    if (runGlobalEffects) run(globalEffects, timestamp);\n    if (!state) roots.forEach(function (root) {\n      return render$1(timestamp, root.store.getState());\n    });else render$1(timestamp, state);\n    if (runGlobalEffects) run(globalAfterEffects, timestamp);\n  }\n\n  return {\n    loop: loop,\n    invalidate: invalidate,\n    advance: advance\n  };\n}\n\nfunction createPointerEvents(store) {\n  var _createEvents = createEvents(store),\n      handlePointer = _createEvents.handlePointer;\n\n  var names = {\n    onClick: ['click', false],\n    onContextMenu: ['contextmenu', false],\n    onDoubleClick: ['dblclick', false],\n    onWheel: ['wheel', true],\n    onPointerDown: ['pointerdown', true],\n    onPointerUp: ['pointerup', true],\n    onPointerLeave: ['pointerleave', true],\n    onPointerMove: ['pointermove', true],\n    onPointerCancel: ['pointercancel', true],\n    onLostPointerCapture: ['lostpointercapture', true]\n  };\n  return {\n    connected: false,\n    handlers: Object.keys(names).reduce(function (acc, key) {\n      return _objectSpread(_objectSpread({}, acc), {}, _defineProperty({}, key, handlePointer(key)));\n    }, {}),\n    connect: function connect(target) {\n      var _events$handlers;\n\n      var _store$getState7 = store.getState(),\n          set = _store$getState7.set,\n          events = _store$getState7.events;\n\n      events.disconnect == null ? void 0 : events.disconnect();\n      set(function (state) {\n        return {\n          events: _objectSpread(_objectSpread({}, state.events), {}, {\n            connected: target\n          })\n        };\n      });\n      Object.entries((_events$handlers = events == null ? void 0 : events.handlers) != null ? _events$handlers : []).forEach(function (_ref16) {\n        var _ref17 = _slicedToArray(_ref16, 2),\n            name = _ref17[0],\n            event = _ref17[1];\n\n        var _names$name = _slicedToArray(names[name], 2),\n            eventName = _names$name[0],\n            passive = _names$name[1];\n\n        target.addEventListener(eventName, event, {\n          passive: passive\n        });\n      });\n    },\n    disconnect: function disconnect() {\n      var _store$getState8 = store.getState(),\n          set = _store$getState8.set,\n          events = _store$getState8.events;\n\n      if (events.connected) {\n        var _events$handlers2;\n\n        Object.entries((_events$handlers2 = events.handlers) != null ? _events$handlers2 : []).forEach(function (_ref18) {\n          var _ref19 = _slicedToArray(_ref18, 2),\n              name = _ref19[0],\n              event = _ref19[1];\n\n          if (events && events.connected instanceof HTMLElement) {\n            var _names$name2 = _slicedToArray(names[name], 1),\n                eventName = _names$name2[0];\n\n            events.connected.removeEventListener(eventName, event);\n          }\n        });\n        set(function (state) {\n          return {\n            events: _objectSpread(_objectSpread({}, state.events), {}, {\n              connected: false\n            })\n          };\n        });\n      }\n    }\n  };\n} // React currently throws a warning when using useLayoutEffect on the server.\n// To get around it, we can conditionally useEffect on the server (no-op) and\n// useLayoutEffect in the browser.\n\n\nvar useIsomorphicLayoutEffect = typeof window !== 'undefined' ? React.useLayoutEffect : React.useEffect;\n\nfunction Block(_ref20) {\n  var set = _ref20.set;\n  useIsomorphicLayoutEffect(function () {\n    set(new Promise(function () {\n      return null;\n    }));\n    return function () {\n      return set(false);\n    };\n  }, []);\n  return null;\n}\n\nvar ErrorBoundary = /*#__PURE__*/function (_React$Component) {\n  _inherits(ErrorBoundary, _React$Component);\n\n  var _super = _createSuper(ErrorBoundary);\n\n  function ErrorBoundary() {\n    var _this;\n\n    _classCallCheck(this, ErrorBoundary);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.state = {\n      error: false\n    };\n    return _this;\n  }\n\n  _createClass(ErrorBoundary, [{\n    key: \"componentDidCatch\",\n    value: function componentDidCatch(error) {\n      this.props.set(error);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return this.state.error ? null : this.props.children;\n    }\n  }]);\n\n  return ErrorBoundary;\n}(React.Component);\n\nErrorBoundary.getDerivedStateFromError = function () {\n  return {\n    error: true\n  };\n};\n\nvar Canvas = /*#__PURE__*/React.forwardRef(function Canvas(_ref21, forwardedRef) {\n  var children = _ref21.children,\n      fallback = _ref21.fallback,\n      tabIndex = _ref21.tabIndex,\n      resize = _ref21.resize,\n      id = _ref21.id,\n      style = _ref21.style,\n      className = _ref21.className,\n      events = _ref21.events,\n      props = _objectWithoutProperties(_ref21, _excluded7);\n\n  var _useMeasure = useMeasure(_objectSpread({\n    scroll: true,\n    debounce: {\n      scroll: 50,\n      resize: 0\n    }\n  }, resize)),\n      _useMeasure2 = _slicedToArray(_useMeasure, 2),\n      containerRef = _useMeasure2[0],\n      _useMeasure2$ = _useMeasure2[1],\n      width = _useMeasure2$.width,\n      height = _useMeasure2$.height;\n\n  var canvasRef = React.useRef(null);\n\n  var _React$useState = React.useState(false),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      block = _React$useState2[0],\n      setBlock = _React$useState2[1];\n\n  var _React$useState3 = React.useState(false),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      error = _React$useState4[0],\n      setError = _React$useState4[1]; // Suspend this component if block is a promise (2nd run)\n\n\n  if (block) throw block; // Throw exception outwards if anything within canvas throws\n\n  if (error) throw error; // Execute JSX in the reconciler as a layout-effect\n\n  useIsomorphicLayoutEffect(function () {\n    if (width > 0 && height > 0) {\n      render( /*#__PURE__*/React.createElement(ErrorBoundary, {\n        set: setError\n      }, /*#__PURE__*/React.createElement(React.Suspense, {\n        fallback: /*#__PURE__*/React.createElement(Block, {\n          set: setBlock\n        })\n      }, children)), canvasRef.current, _objectSpread(_objectSpread({}, props), {}, {\n        size: {\n          width: width,\n          height: height\n        },\n        events: events || createPointerEvents\n      }));\n    }\n  }, [width, height, children]);\n  useIsomorphicLayoutEffect(function () {\n    var container = canvasRef.current;\n    return function () {\n      return unmountComponentAtNode(container);\n    };\n  }, []);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    ref: containerRef,\n    id: id,\n    className: className,\n    tabIndex: tabIndex,\n    style: _objectSpread({\n      position: 'relative',\n      width: '100%',\n      height: '100%',\n      overflow: 'hidden'\n    }, style)\n  }, /*#__PURE__*/React.createElement(\"canvas\", {\n    ref: mergeRefs([canvasRef, forwardedRef]),\n    style: {\n      display: 'block'\n    }\n  }, fallback));\n});\n\nfunction useStore() {\n  var store = React.useContext(context);\n  if (!store) throw \"R3F hooks can only be used within the Canvas component!\";\n  return store;\n}\n\nfunction useThree() {\n  var selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : function (state) {\n    return state;\n  };\n  var equalityFn = arguments.length > 1 ? arguments[1] : undefined;\n  return useStore()(selector, equalityFn);\n}\n\nfunction useFrame(callback) {\n  var renderPriority = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  var subscribe = useStore().getState().internal.subscribe; // Update ref\n\n  var ref = React.useRef(callback);\n  React.useLayoutEffect(function () {\n    return void (ref.current = callback);\n  }, [callback]); // Subscribe on mount, unsubscribe on unmount\n\n  React.useLayoutEffect(function () {\n    return subscribe(ref, renderPriority);\n  }, [renderPriority, subscribe]);\n  return null;\n}\n\nfunction buildGraph(object) {\n  var data = {\n    nodes: {},\n    materials: {}\n  };\n\n  if (object) {\n    object.traverse(function (obj) {\n      if (obj.name) {\n        data.nodes[obj.name] = obj;\n      }\n\n      if (obj.material && !data.materials[obj.material.name]) {\n        data.materials[obj.material.name] = obj.material;\n      }\n    });\n  }\n\n  return data;\n}\n\nfunction useGraph(object) {\n  return React.useMemo(function () {\n    return buildGraph(object);\n  }, [object]);\n}\n\nfunction loadingFn(extensions, onProgress) {\n  return function (Proto) {\n    // Construct new loader and run extensions\n    var loader = new Proto();\n    if (extensions) extensions(loader); // Go through the urls and load them\n\n    for (var _len2 = arguments.length, input = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n      input[_key2 - 1] = arguments[_key2];\n    }\n\n    return Promise.all(input.map(function (input) {\n      return new Promise(function (res, reject) {\n        return loader.load(input, function (data) {\n          if (data.scene) Object.assign(data, buildGraph(data.scene));\n          res(data);\n        }, onProgress, function (error) {\n          return reject(\"Could not load \".concat(input, \": \").concat(error.message));\n        });\n      });\n    }));\n  };\n}\n\nfunction useLoader(Proto, input, extensions, onProgress) {\n  // Use suspense to load async assets\n  var keys = Array.isArray(input) ? input : [input];\n  var results = useAsset.apply(void 0, [loadingFn(extensions, onProgress), Proto].concat(_toConsumableArray(keys))); // Return the object/s\n\n  return Array.isArray(input) ? results : results[0];\n}\n\nuseLoader.preload = function (Proto, input, extensions) {\n  var keys = Array.isArray(input) ? input : [input];\n  return useAsset.preload.apply(useAsset, [loadingFn(extensions), Proto].concat(_toConsumableArray(keys)));\n};\n\nuseLoader.clear = function (Proto, input) {\n  var keys = Array.isArray(input) ? input : [input];\n  return useAsset.clear.apply(useAsset, [Proto].concat(_toConsumableArray(keys)));\n};\n\nvar roots = new Map();\nvar modes = ['legacy', 'blocking', 'concurrent'];\n\nvar _createLoop = createLoop(roots),\n    invalidate = _createLoop.invalidate,\n    advance = _createLoop.advance;\n\nvar _createRenderer = createRenderer(),\n    reconciler = _createRenderer.reconciler,\n    applyProps = _createRenderer.applyProps;\n\nvar createRendererInstance = function createRendererInstance(gl, canvas) {\n  var customRenderer = typeof gl === 'function' ? gl(canvas) : gl;\n  if (isRenderer(customRenderer)) return customRenderer;\n  var renderer = new THREE.WebGLRenderer(_objectSpread({\n    powerPreference: 'high-performance',\n    canvas: canvas,\n    antialias: true,\n    alpha: true\n  }, gl));\n  if (gl) applyProps(renderer, gl);\n  return renderer;\n};\n\nfunction render(element, canvas) {\n  var _ref22 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n      gl = _ref22.gl,\n      size = _ref22.size,\n      _ref22$mode = _ref22.mode,\n      mode = _ref22$mode === void 0 ? modes[1] : _ref22$mode,\n      events = _ref22.events,\n      onCreated = _ref22.onCreated,\n      props = _objectWithoutProperties(_ref22, _excluded8);\n\n  var _store; // Allow size to take on container bounds initially\n\n\n  if (!size) {\n    var _canvas$parentElement, _canvas$parentElement2, _canvas$parentElement3, _canvas$parentElement4;\n\n    size = {\n      width: (_canvas$parentElement = (_canvas$parentElement2 = canvas.parentElement) == null ? void 0 : _canvas$parentElement2.clientWidth) != null ? _canvas$parentElement : 0,\n      height: (_canvas$parentElement3 = (_canvas$parentElement4 = canvas.parentElement) == null ? void 0 : _canvas$parentElement4.clientHeight) != null ? _canvas$parentElement3 : 0\n    };\n  }\n\n  var root = roots.get(canvas);\n  var fiber = root == null ? void 0 : root.fiber;\n  var store = root == null ? void 0 : root.store;\n  var state = (_store = store) == null ? void 0 : _store.getState();\n\n  if (fiber && state) {\n    // When a root was found, see if any fundamental props must be changed or exchanged\n    // Check pixelratio\n    if (props.dpr !== undefined && !is.equ(state.viewport.dpr, calculateDpr(props.dpr))) state.setDpr(props.dpr); // Check size\n\n    if (state.size.width !== size.width || state.size.height !== size.height) state.setSize(size.width, size.height); // For some props we want to reset the entire root\n    // Changes to the color-space\n\n    var linearChanged = props.linear !== state.internal.lastProps.linear;\n\n    if (linearChanged) {\n      unmountComponentAtNode(canvas);\n      fiber = undefined;\n    }\n  }\n\n  if (!fiber) {\n    // If no root has been found, make one\n    // Create gl\n    var glRenderer = createRendererInstance(gl, canvas); // Enable VR if requested\n\n    if (props.vr) {\n      glRenderer.xr.enabled = true;\n      glRenderer.setAnimationLoop(function (timestamp) {\n        return advance(timestamp, true);\n      });\n    } // Create store\n\n\n    store = createStore(applyProps, invalidate, advance, _objectSpread({\n      gl: glRenderer,\n      size: size\n    }, props));\n\n    var _state = store.getState(); // Create renderer\n\n\n    fiber = reconciler.createContainer(store, modes.indexOf(mode), false, null); // Map it\n\n    roots.set(canvas, {\n      fiber: fiber,\n      store: store\n    }); // Store events internally\n\n    if (events) _state.set({\n      events: events(store)\n    });\n  }\n\n  if (store && fiber) {\n    reconciler.updateContainer( /*#__PURE__*/React.createElement(Provider, {\n      store: store,\n      element: element,\n      onCreated: onCreated,\n      target: canvas\n    }), fiber, null, function () {\n      return undefined;\n    });\n    return store;\n  } else {\n    throw 'Error creating root!';\n  }\n}\n\nfunction Provider(_ref23) {\n  var store = _ref23.store,\n      element = _ref23.element,\n      onCreated = _ref23.onCreated,\n      target = _ref23.target;\n  React.useEffect(function () {\n    var state = store.getState(); // Flag the canvas active, rendering will now begin\n\n    state.set(function (state) {\n      return {\n        internal: _objectSpread(_objectSpread({}, state.internal), {}, {\n          active: true\n        })\n      };\n    }); // Connect events\n\n    state.events.connect == null ? void 0 : state.events.connect(target); // Notifiy that init is completed, the scene graph exists, but nothing has yet rendered\n\n    if (onCreated) onCreated(state);\n  }, []);\n  return /*#__PURE__*/React.createElement(context.Provider, {\n    value: store\n  }, element);\n}\n\nfunction unmountComponentAtNode(canvas, callback) {\n  var root = roots.get(canvas);\n  var fiber = root == null ? void 0 : root.fiber;\n\n  if (fiber) {\n    var state = root == null ? void 0 : root.store.getState();\n    if (state) state.internal.active = false;\n    reconciler.updateContainer(null, fiber, null, function () {\n      if (state) {\n        setTimeout(function () {\n          var _state$gl, _state$gl$renderLists, _state$gl2;\n\n          state.events.disconnect == null ? void 0 : state.events.disconnect();\n          (_state$gl = state.gl) == null ? void 0 : (_state$gl$renderLists = _state$gl.renderLists) == null ? void 0 : _state$gl$renderLists.dispose == null ? void 0 : _state$gl$renderLists.dispose();\n          (_state$gl2 = state.gl) == null ? void 0 : _state$gl2.forceContextLoss == null ? void 0 : _state$gl2.forceContextLoss();\n          dispose(state);\n          roots.delete(canvas);\n          if (callback) callback(canvas);\n        }, 500);\n      }\n    });\n  }\n}\n\nfunction dispose(obj) {\n  if (obj.dispose && obj.type !== 'Scene') obj.dispose();\n\n  for (var p in obj) {\n    var _dispose, _ref;\n\n    (_dispose = (_ref = p).dispose) == null ? void 0 : _dispose.call(_ref);\n    delete obj[p];\n  }\n}\n\nvar act = reconciler.act;\n\nfunction createPortal(children, container) {\n  return reconciler.createPortal(children, container, null, null);\n}\n\nreconciler.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  rendererPackageName: '@react-three/fiber',\n  version: '17.0.2'\n});\nexport { Canvas, threeTypes as ReactThreeFiber, roots as _roots, act, addAfterEffect, addEffect, addTail, advance, applyProps, context, createPortal, dispose, createPointerEvents as events, extend, invalidate, reconciler, render, unmountComponentAtNode, useFrame, useGraph, useLoader, useStore, useThree };","map":{"version":3,"sources":["/Users/lordokami/lordokami/lost-my-keys-vr/node_modules/@react-three/fiber/dist/react-three-fiber.esm.js"],"names":["THREE","React","create","shallow","Reconciler","unstable_now","unstable_runWithPriority","unstable_IdlePriority","useAsset","mergeRefs","useMeasure","threeTypes","Object","freeze","__proto__","is","obj","a","arr","fun","str","num","und","Array","isArray","equ","b","i","makeId","event","eventObject","object","uuid","index","instanceId","removeInteractivity","store","getState","internal","interaction","filter","o","initialHits","hovered","forEach","value","key","delete","createEvents","temp","Vector3","prepareRay","_raycaster$computeOff","state","raycaster","mouse","camera","size","computeOffsets","offsetX","offsetY","width","height","set","setFromCamera","calculateDistance","dx","initialClick","dy","Math","round","sqrt","filterPointerEvents","objects","some","name","_r3f","__r3f","handlers","intersect","enabled","seen","Set","intersections","eventsObjects","intersects","intersectObjects","item","id","has","add","_r3f2","eventCount","push","parent","patchIntersects","capturedMap","pointerId","get","values","handleIntersects","delta","callback","length","unprojectedPoint","x","y","unproject","releasePointerCapture","target","localState","stopped","hit","hasPointerCapture","_internal$capturedMap","_internal$capturedMap2","setPointerCapture","Map","extractEventProps","prop","getPrototypeOf","property","raycastEvent","spaceX","spaceY","ray","stopPropagation","capturesForPointer","from","find","higher","slice","indexOf","cancelPointer","currentTarget","sourceEvent","nativeEvent","hits","hoveredObj","instance","data","onPointerOut","onPointerLeave","handlePointer","onPointerMissed","isPointerMove","isClickEvent","undefined","map","pointerMissed","onPointerOver","onPointerEnter","hoveredItem","onPointerMove","handler","includes","_r3f3","isDiffSet","def","memoized","changes","isStore","getContainer","container","child","_container$__r3f$root","_container$__r3f","root","scene","DEFAULT","EMPTY","catalogue","extend","checkShallow","prepare","primitive","memoizedProps","createRenderer","roots","diffProps","cN","children","kN","rN","ref","props","cP","kP","rP","previous","accumulative","_instance$__r3f","entries","previousKeys","keys","hasOwnProperty","unshift","_instance$__r3f2","test","split","args","attach","applyProps","_instance$__r3f3","_root$getState","_instance$__r3f4","rootState","prevHandlers","isEvent","currentInstance","targetProp","reduce","acc","reverse","reverseEntries","constructor","defaultClassCall","dispose","copy","Layers","fromArray","isColor","Color","setScalar","mask","linear","convertSRGBToLinear","Texture","encoding","sRGBEncoding","invalidateInstance","raycast","splice","updateInstance","_instance$__r3f5","_instance$__r3f5$root","frames","invalidate","onUpdate","createInstance","type","hostContext","internalInstanceHandle","toUpperCase","fn","node","return","stateNode","containerInfo","endsWith","appendChild","parentInstance","addedAsChild","attachArray","attachObject","attachFns","attachFn","isObject3D","insertBefore","beforeChild","added","array","dispatchEvent","restSiblings","sibling","removeRecursive","removeChild","_parentInstance$__r3f","_child$__r3f2","detachFn","_child$__r3f","remove","isPrimitive","shouldDispose","_child$__r3f3","e","switchInstance","newProps","fiber","_instance$__r3f6","newInstance","alternate","current","reconciler","now","appendInitialChild","warnsIfNotActing","supportsMutation","isPrimaryRenderer","scheduleTimeout","setTimeout","cancelTimeout","clearTimeout","noTimeout","appendChildToContainer","removeChildFromContainer","insertInContainerBefore","prepareUpdate","oldProps","argsNew","restNew","argsOld","cO","restOld","diff","commitUpdate","reconstruct","hideInstance","visible","unhideInstance","hideTextInstance","Error","getPublicInstance","getRootHostContext","rootContainer","getChildHostContext","parentHostContext","createTextInstance","finalizeInitialChildren","commitMount","shouldDeprioritizeSubtree","prepareForCommit","preparePortalMount","resetAfterCommit","shouldSetTextContent","clearContainer","isRenderer","render","isOrthographicCamera","calculateDpr","dpr","min","max","window","devicePixelRatio","context","createContext","createStore","advance","gl","shadows","flat","vr","orthographic","frameloop","performance","clock","Clock","raycastOptions","cameraOptions","shadowMap","assign","PCFSoftShadowMap","outputEncoding","toneMapping","ACESFilmicToneMapping","stop","elapsedTime","Raycaster","params","options","isCamera","Camera","OrthographicCamera","PerspectiveCamera","position","z","rotation","lookAt","initialDpr","defaultTarget","tempTarget","getCurrentViewport","aspect","distance","getWorldPosition","distanceTo","zoom","factor","fov","PI","h","tan","w","performanceTimeout","setPerformanceCurrent","timestamp","runGlobalEffects","Scene","controls","Vector2","debounce","regress","viewport","setSize","setDpr","events","connected","active","priority","lastProps","subscribers","subscribe","sort","s","left","right","top","bottom","updateProjectionMatrix","updateMatrixWorld","setPixelRatio","createSubs","subs","globalEffects","globalAfterEffects","globalTailEffects","addEffect","addAfterEffect","addTail","run","effects","render$1","getDelta","oldTime","createLoop","running","repeat","loop","requestAnimationFrame","createPointerEvents","names","onClick","onContextMenu","onDoubleClick","onWheel","onPointerDown","onPointerUp","onPointerCancel","onLostPointerCapture","connect","_events$handlers","disconnect","eventName","passive","addEventListener","_events$handlers2","HTMLElement","removeEventListener","useIsomorphicLayoutEffect","useLayoutEffect","useEffect","Block","Promise","ErrorBoundary","error","Component","getDerivedStateFromError","Canvas","forwardRef","forwardedRef","fallback","tabIndex","resize","style","className","scroll","containerRef","canvasRef","useRef","useState","block","setBlock","setError","createElement","Suspense","unmountComponentAtNode","overflow","display","useStore","useContext","useThree","selector","equalityFn","useFrame","renderPriority","buildGraph","nodes","materials","traverse","material","useGraph","useMemo","loadingFn","extensions","onProgress","Proto","loader","input","all","res","reject","load","message","useLoader","results","preload","clear","modes","createRendererInstance","canvas","customRenderer","renderer","WebGLRenderer","powerPreference","antialias","alpha","element","mode","onCreated","_store","_canvas$parentElement","_canvas$parentElement2","_canvas$parentElement3","_canvas$parentElement4","parentElement","clientWidth","clientHeight","linearChanged","glRenderer","xr","setAnimationLoop","createContainer","updateContainer","Provider","_state$gl","_state$gl$renderLists","_state$gl2","renderLists","forceContextLoss","p","_dispose","_ref","call","act","createPortal","injectIntoDevTools","bundleType","process","env","NODE_ENV","rendererPackageName","version","ReactThreeFiber","_roots"],"mappings":"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","sourcesContent":["import * as THREE from 'three';\nimport * as React from 'react';\nimport create from 'zustand';\nimport shallow from 'zustand/shallow';\nimport Reconciler from 'react-reconciler';\nimport { unstable_now, unstable_runWithPriority, unstable_IdlePriority } from 'scheduler';\nimport { useAsset } from 'use-asset';\nimport mergeRefs from 'react-merge-refs';\nimport useMeasure from 'react-use-measure';\n\nvar threeTypes = /*#__PURE__*/Object.freeze({\n  __proto__: null\n});\n\nconst is = {\n  obj: a => a === Object(a) && !is.arr(a) && typeof a !== 'function',\n  fun: a => typeof a === 'function',\n  str: a => typeof a === 'string',\n  num: a => typeof a === 'number',\n  und: a => a === void 0,\n  arr: a => Array.isArray(a),\n\n  equ(a, b) {\n    // Wrong type or one of the two undefined, doesn't match\n    if (typeof a !== typeof b || !!a !== !!b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    let i;\n\n    for (i in a) if (!(i in b)) return false;\n\n    for (i in b) if (a[i] !== b[i]) return false;\n\n    return is.und(i) ? a === b : true;\n  }\n\n};\n\nfunction makeId(event) {\n  return (event.eventObject || event.object).uuid + '/' + event.index + event.instanceId;\n}\n\nfunction removeInteractivity(store, object) {\n  const {\n    internal\n  } = store.getState(); // Removes every trace of an object from the data store\n\n  internal.interaction = internal.interaction.filter(o => o !== object);\n  internal.initialHits = internal.initialHits.filter(o => o !== object);\n  internal.hovered.forEach((value, key) => {\n    if (value.eventObject === object || value.object === object) {\n      internal.hovered.delete(key);\n    }\n  });\n}\nfunction createEvents(store) {\n  const temp = new THREE.Vector3();\n  /** Sets up defaultRaycaster */\n\n  function prepareRay(event) {\n    var _raycaster$computeOff;\n\n    const state = store.getState();\n    const {\n      raycaster,\n      mouse,\n      camera,\n      size\n    } = state; // https://github.com/pmndrs/react-three-fiber/pull/782\n    // Events trigger outside of canvas when moved\n\n    const {\n      offsetX,\n      offsetY\n    } = (_raycaster$computeOff = raycaster.computeOffsets == null ? void 0 : raycaster.computeOffsets(event, state)) != null ? _raycaster$computeOff : event;\n    const {\n      width,\n      height\n    } = size;\n    mouse.set(offsetX / width * 2 - 1, -(offsetY / height) * 2 + 1);\n    raycaster.setFromCamera(mouse, camera);\n  }\n  /** Calculates delta */\n\n\n  function calculateDistance(event) {\n    const {\n      internal\n    } = store.getState();\n    const dx = event.offsetX - internal.initialClick[0];\n    const dy = event.offsetY - internal.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }\n  /** Returns true if an instance has a valid pointer-event registered, this excludes scroll, clicks etc */\n\n\n  function filterPointerEvents(objects) {\n    return objects.filter(obj => ['Move', 'Over', 'Enter', 'Out', 'Leave'].some(name => {\n      var _r3f;\n\n      return (_r3f = obj.__r3f) == null ? void 0 : _r3f.handlers['onPointer' + name];\n    }));\n  }\n\n  function intersect(filter) {\n    const state = store.getState();\n    const {\n      raycaster,\n      internal\n    } = state; // Skip event handling when noEvents is set\n\n    if (!raycaster.enabled) return [];\n    const seen = new Set();\n    const intersections = []; // Allow callers to eliminate event objects\n\n    const eventsObjects = filter ? filter(internal.interaction) : internal.interaction; // Intersect known handler objects and filter against duplicates\n\n    let intersects = raycaster.intersectObjects(eventsObjects, true).filter(item => {\n      const id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // https://github.com/mrdoob/three.js/issues/16031\n    // Allow custom userland intersect sort order\n\n    if (raycaster.filter) intersects = raycaster.filter(intersects, state);\n\n    for (const intersect of intersects) {\n      let eventObject = intersect.object; // Bubble event up\n\n      while (eventObject) {\n        var _r3f2;\n\n        if ((_r3f2 = eventObject.__r3f) != null && _r3f2.eventCount) intersections.push({ ...intersect,\n          eventObject\n        });\n        eventObject = eventObject.parent;\n      }\n    }\n\n    return intersections;\n  }\n  /**  Creates filtered intersects and returns an array of positive hits */\n\n\n  function patchIntersects(intersections, event) {\n    const {\n      internal\n    } = store.getState(); // If the interaction is captured, make all capturing targets  part of the\n    // intersect.\n\n    if ('pointerId' in event && internal.capturedMap.has(event.pointerId)) {\n      intersections.push(...internal.capturedMap.get(event.pointerId).values());\n    }\n\n    return intersections;\n  }\n  /**  Handles intersections by forwarding them to handlers */\n\n\n  function handleIntersects(intersections, event, delta, callback) {\n    const {\n      raycaster,\n      mouse,\n      camera,\n      internal\n    } = store.getState(); // If anything has been found, forward it to the event listeners\n\n    if (intersections.length) {\n      const unprojectedPoint = temp.set(mouse.x, mouse.y, 0).unproject(camera);\n\n      const releasePointerCapture = id => event.target.releasePointerCapture(id);\n\n      const localState = {\n        stopped: false\n      };\n\n      for (const hit of intersections) {\n        const hasPointerCapture = id => {\n          var _internal$capturedMap, _internal$capturedMap2;\n\n          return (_internal$capturedMap = (_internal$capturedMap2 = internal.capturedMap.get(id)) == null ? void 0 : _internal$capturedMap2.has(hit.eventObject)) != null ? _internal$capturedMap : false;\n        };\n\n        const setPointerCapture = id => {\n          if (internal.capturedMap.has(id)) {\n            // if the pointerId was previously captured, we add the hit to the\n            // event capturedMap.\n            internal.capturedMap.get(id).set(hit.eventObject, hit);\n          } else {\n            // if the pointerId was not previously captured, we create a map\n            // containing the hitObject, and the hit. hitObject is used for\n            // faster access.\n            internal.capturedMap.set(id, new Map([[hit.eventObject, hit]]));\n          } // Call the original event now\n          event.target.setPointerCapture(id);\n        }; // Add native event props\n\n\n        let extractEventProps = {};\n\n        for (let prop in Object.getPrototypeOf(event)) {\n          let property = event[prop]; // Only copy over atomics, leave functions alone as these should be\n          // called as event.nativeEvent.fn()\n\n          if (typeof property !== 'function') extractEventProps[prop] = property;\n        }\n\n        let raycastEvent = { ...hit,\n          ...extractEventProps,\n          spaceX: mouse.x,\n          spaceY: mouse.y,\n          intersections,\n          stopped: localState.stopped,\n          delta,\n          unprojectedPoint,\n          ray: raycaster.ray,\n          camera: camera,\n          // Hijack stopPropagation, which just sets a flag\n          stopPropagation: () => {\n            // https://github.com/pmndrs/react-three-fiber/issues/596\n            // Events are not allowed to stop propagation if the pointer has been captured\n            const capturesForPointer = 'pointerId' in event && internal.capturedMap.get(event.pointerId); // We only authorize stopPropagation...\n\n            if ( // ...if this pointer hasn't been captured\n            !capturesForPointer || // ... or if the hit object is capturing the pointer\n            capturesForPointer.has(hit.eventObject)) {\n              raycastEvent.stopped = localState.stopped = true; // Propagation is stopped, remove all other hover records\n              // An event handler is only allowed to flush other handlers if it is hovered itself\n\n              if (internal.hovered.size && Array.from(internal.hovered.values()).find(i => i.eventObject === hit.eventObject)) {\n                // Objects cannot flush out higher up objects that have already caught the event\n                const higher = intersections.slice(0, intersections.indexOf(hit));\n                cancelPointer([...higher, hit]);\n              }\n            }\n          },\n          // there should be a distinction between target and currentTarget\n          target: {\n            hasPointerCapture,\n            setPointerCapture,\n            releasePointerCapture\n          },\n          currentTarget: {\n            hasPointerCapture,\n            setPointerCapture,\n            releasePointerCapture\n          },\n          sourceEvent: event,\n          // deprecated\n          nativeEvent: event\n        }; // Call subscribers\n\n        callback(raycastEvent); // Event bubbling may be interrupted by stopPropagation\n\n        if (localState.stopped === true) break;\n      }\n    }\n\n    return intersections;\n  }\n\n  function cancelPointer(hits) {\n    const {\n      internal\n    } = store.getState();\n    Array.from(internal.hovered.values()).forEach(hoveredObj => {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (!hits.length || !hits.find(hit => hit.object === hoveredObj.object && hit.index === hoveredObj.index && hit.instanceId === hoveredObj.instanceId)) {\n        const eventObject = hoveredObj.eventObject;\n        const instance = eventObject.__r3f;\n        const handlers = instance == null ? void 0 : instance.handlers;\n        internal.hovered.delete(makeId(hoveredObj));\n\n        if (instance != null && instance.eventCount) {\n          // Clear out intersects, they are outdated by now\n          const data = { ...hoveredObj,\n            intersections: hits || []\n          };\n          handlers.onPointerOut == null ? void 0 : handlers.onPointerOut(data);\n          handlers.onPointerLeave == null ? void 0 : handlers.onPointerLeave(data);\n        }\n      }\n    });\n  }\n\n  const handlePointer = name => {\n    // Deal with cancelation\n    switch (name) {\n      case 'onPointerLeave':\n      case 'onPointerCancel':\n        return () => cancelPointer([]);\n\n      case 'onLostPointerCapture':\n        return event => {\n          if ('pointerId' in event) {\n            // this will be a problem if one target releases the pointerId\n            // and another one is still keeping it, as the line below\n            // indifferently deletes all capturing references.\n            store.getState().internal.capturedMap.delete(event.pointerId);\n          }\n\n          cancelPointer([]);\n        };\n    } // Any other pointer goes here ...\n\n\n    return event => {\n      const {\n        onPointerMissed,\n        internal\n      } = store.getState();\n      prepareRay(event); // Get fresh intersects\n\n      const isPointerMove = name === 'onPointerMove';\n      const isClickEvent = name === 'onClick' || name === 'onContextMenu' || name === 'onDoubleClick';\n      const filter = isPointerMove ? filterPointerEvents : undefined;\n      const hits = patchIntersects(intersect(filter), event);\n      const delta = isClickEvent ? calculateDistance(event) : 0; // Save initial coordinates on pointer-down\n\n      if (name === 'onPointerDown') {\n        internal.initialClick = [event.offsetX, event.offsetY];\n        internal.initialHits = hits.map(hit => hit.eventObject);\n      } // If a click yields no results, pass it back to the user as a miss\n      // Missed events have to come first in order to establish user-land side-effect clean up\n\n\n      if (isClickEvent && !hits.length) {\n        if (delta <= 2) {\n          pointerMissed(event, internal.interaction);\n          if (onPointerMissed) onPointerMissed(event);\n        }\n      } // Take care of unhover\n\n\n      if (isPointerMove) cancelPointer(hits);\n      handleIntersects(hits, event, delta, data => {\n        const eventObject = data.eventObject;\n        const instance = eventObject.__r3f;\n        const handlers = instance == null ? void 0 : instance.handlers; // Check presence of handlers\n\n        if (!(instance != null && instance.eventCount)) return;\n\n        if (isPointerMove) {\n          // Move event ...\n          if (handlers.onPointerOver || handlers.onPointerEnter || handlers.onPointerOut || handlers.onPointerLeave) {\n            // When enter or out is present take care of hover-state\n            const id = makeId(data);\n            const hoveredItem = internal.hovered.get(id);\n\n            if (!hoveredItem) {\n              // If the object wasn't previously hovered, book it and call its handler\n              internal.hovered.set(id, data);\n              handlers.onPointerOver == null ? void 0 : handlers.onPointerOver(data);\n              handlers.onPointerEnter == null ? void 0 : handlers.onPointerEnter(data);\n            } else if (hoveredItem.stopped) {\n              // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n              data.stopPropagation();\n            }\n          } // Call mouse move\n\n\n          handlers.onPointerMove == null ? void 0 : handlers.onPointerMove(data);\n        } else {\n          // All other events ...\n          const handler = handlers[name];\n\n          if (handler) {\n            // Forward all events back to their respective handlers with the exception of click events,\n            // which must use the initial target\n            if (name !== 'onClick' && name !== 'onContextMenu' && name !== 'onDoubleClick' || internal.initialHits.includes(eventObject)) {\n              // Missed events have to come first\n              pointerMissed(event, internal.interaction.filter(object => !internal.initialHits.includes(object))); // Now call the handler\n\n              handler(data);\n            }\n          }\n        }\n      });\n    };\n  };\n\n  function pointerMissed(event, objects) {\n    objects.forEach(object => {\n      var _r3f3;\n\n      return (_r3f3 = object.__r3f) == null ? void 0 : _r3f3.handlers.onPointerMissed == null ? void 0 : _r3f3.handlers.onPointerMissed(event);\n    });\n  }\n\n  return {\n    handlePointer\n  };\n}\n\nconst isDiffSet = def => def && !!def.memoized && !!def.changes;\n\n// Type guard to tell a store from a portal\nconst isStore = def => def && !!def.getState;\n\nconst getContainer = (container, child) => {\n  var _container$__r3f$root, _container$__r3f;\n\n  return {\n    // If the container is not a root-store then it must be a THREE.Object3D into which part of the\n    // scene is portalled into. Now there can be two variants of this, either that object is part of\n    // the regular jsx tree, in which case it already has __r3f with a valid root attached, or it lies\n    // outside react, in which case we must take the root of the child that is about to be attached to it.\n    root: isStore(container) ? container : (_container$__r3f$root = (_container$__r3f = container.__r3f) == null ? void 0 : _container$__r3f.root) != null ? _container$__r3f$root : child.__r3f.root,\n    // The container is the eventual target into which objects are mounted, it has to be a THREE.Object3D\n    container: isStore(container) ? container.getState().scene : container\n  };\n};\n\nconst DEFAULT = '__default';\nconst EMPTY = {};\nlet catalogue = {};\n\nlet extend = objects => void (catalogue = { ...catalogue,\n  ...objects\n}); // Shallow check arrays, but check objects atomically\n\n\nfunction checkShallow(a, b) {\n  if (is.arr(a) && is.equ(a, b)) return true;\n  if (a === b) return true;\n  return false;\n} // Each object in the scene carries a small LocalState descriptor\n\n\nfunction prepare(object, state) {\n  const instance = object;\n\n  if (state != null && state.primitive || !instance.__r3f) {\n    instance.__r3f = {\n      root: null,\n      memoizedProps: {},\n      eventCount: 0,\n      handlers: {},\n      objects: [],\n      parent: null,\n      ...state\n    };\n  }\n\n  return object;\n}\n\nfunction createRenderer(roots) {\n  // This function prepares a set of changes to be applied to the instance\n  function diffProps(instance, {\n    children: cN,\n    key: kN,\n    ref: rN,\n    ...props\n  }, {\n    children: cP,\n    key: kP,\n    ref: rP,\n    ...previous\n  } = {}, accumulative = false) {\n    var _instance$__r3f;\n\n    const localState = (_instance$__r3f = instance == null ? void 0 : instance.__r3f) != null ? _instance$__r3f : {};\n    const entries = Object.entries(props);\n    const changes = []; // Catch removed props, prepend them so they can be reset or removed\n\n    if (accumulative) {\n      const previousKeys = Object.keys(previous);\n\n      for (let i = 0; i < previousKeys.length; i++) if (!props.hasOwnProperty(previousKeys[i])) entries.unshift([previousKeys[i], DEFAULT + 'remove']);\n    }\n\n    entries.forEach(([key, value]) => {\n      var _instance$__r3f2;\n\n      // Bail out on primitive object\n      if ((_instance$__r3f2 = instance.__r3f) != null && _instance$__r3f2.primitive && key === 'object') return; // When props match bail out\n\n      if (checkShallow(value, previous[key])) return; // Collect handlers and bail out\n\n      if (/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(key)) return changes.push([key, value, true, []]); // Split dashed props\n\n      let entries = [];\n      if (key.includes('-')) entries = key.split('-');\n      changes.push([key, value, false, entries]);\n    });\n    const memoized = { ...props\n    };\n    if (localState.memoizedProps && localState.memoizedProps.args) memoized.args = localState.memoizedProps.args;\n    if (localState.memoizedProps && localState.memoizedProps.attach) memoized.attach = localState.memoizedProps.attach;\n    return {\n      accumulative,\n      memoized,\n      changes\n    };\n  }\n\n  function applyProps(instance, data) {\n    var _instance$__r3f3, _root$getState, _instance$__r3f4;\n\n    // Filter equals, events and reserved props\n    const localState = (_instance$__r3f3 = instance == null ? void 0 : instance.__r3f) != null ? _instance$__r3f3 : {};\n    const root = localState.root;\n    const rootState = (_root$getState = root == null ? void 0 : root.getState == null ? void 0 : root.getState()) != null ? _root$getState : {};\n    const {\n      memoized,\n      changes\n    } = isDiffSet(data) ? data : diffProps(instance, data);\n    const prevHandlers = localState.eventCount; // Prepare memoized props\n\n    if (instance.__r3f) instance.__r3f.memoizedProps = memoized;\n    changes.forEach(([key, value, isEvent, keys]) => {\n      let currentInstance = instance;\n      let targetProp = currentInstance[key]; // Revolve dashed props\n\n      if (keys.length) {\n        targetProp = keys.reduce((acc, key) => acc[key], instance); // If the target is atomic, it forces us to switch the root\n\n        if (!(targetProp && targetProp.set)) {\n          const [name, ...reverseEntries] = keys.reverse();\n          currentInstance = reverseEntries.reverse().reduce((acc, key) => acc[key], instance);\n          key = name;\n        }\n      } // https://github.com/mrdoob/three.js/issues/21209\n      // HMR/fast-refresh relies on the ability to cancel out props, but threejs\n      // has no means to do this. Hence we curate a small collection of value-classes\n      // with their respective constructor/set arguments\n      // For removed props, try to set default values, if possible\n\n\n      if (value === DEFAULT + 'remove') {\n        if (targetProp && targetProp.constructor) {\n          // use the prop constructor to find the default it should be\n          value = new targetProp.constructor(memoized.args);\n        } else if (currentInstance.constructor) {\n          // create a blank slate of the instance and copy the particular parameter.\n          // @ts-ignore\n          const defaultClassCall = new currentInstance.constructor(currentInstance.__r3f.memoizedProps.args);\n          value = defaultClassCall[targetProp]; // destory the instance\n\n          if (defaultClassCall.dispose) defaultClassCall.dispose(); // instance does not have constructor, just set it to 0\n        } else value = 0;\n      } // Deal with pointer events ...\n\n\n      if (isEvent) {\n        if (value) localState.handlers[key] = value;else delete localState.handlers[key];\n        localState.eventCount = Object.keys(localState.handlers).length;\n      } // Special treatment for objects with support for set/copy, and layers\n      else if (targetProp && targetProp.set && (targetProp.copy || targetProp instanceof THREE.Layers)) {\n          // If value is an array\n          if (Array.isArray(value)) {\n            if (targetProp.fromArray) targetProp.fromArray(value);else targetProp.set(...value);\n          } // Test again target.copy(class) next ...\n          else if (targetProp.copy && value && value.constructor && targetProp.constructor.name === value.constructor.name) targetProp.copy(value); // If nothing else fits, just set the single value, ignore undefined\n            // https://github.com/react-spring/react-three-fiber/issues/274\n            else if (value !== undefined) {\n                const isColor = targetProp instanceof THREE.Color; // Allow setting array scalars\n\n                if (!isColor && targetProp.setScalar) targetProp.setScalar(value); // Layers have no copy function, we must therefore copy the mask property\n                else if (targetProp instanceof THREE.Layers && value instanceof THREE.Layers) targetProp.mask = value.mask; // Otherwise just set ...\n                  else targetProp.set(value); // Auto-convert sRGB colors, for now ...\n                // https://github.com/react-spring/react-three-fiber/issues/344\n\n                if (!rootState.linear && isColor) targetProp.convertSRGBToLinear();\n              } // Else, just overwrite the value\n\n        } else {\n          currentInstance[key] = value; // Auto-convert sRGB textures, for now ...\n          // https://github.com/react-spring/react-three-fiber/issues/344\n\n          if (!rootState.linear && currentInstance[key] instanceof THREE.Texture) currentInstance[key].encoding = THREE.sRGBEncoding;\n        }\n\n      invalidateInstance(instance);\n    });\n\n    if (rootState.internal && instance.raycast && prevHandlers !== localState.eventCount) {\n      // Pre-emptively remove the instance from the interaction manager\n      const index = rootState.internal.interaction.indexOf(instance);\n      if (index > -1) rootState.internal.interaction.splice(index, 1); // Add the instance to the interaction manager only when it has handlers\n\n      if (localState.eventCount) rootState.internal.interaction.push(instance);\n    } // Call the update lifecycle when it is being updated\n\n\n    if (changes.length && (_instance$__r3f4 = instance.__r3f) != null && _instance$__r3f4.parent) updateInstance(instance);\n    return instance;\n  }\n\n  function invalidateInstance(instance) {\n    var _instance$__r3f5, _instance$__r3f5$root;\n\n    const state = (_instance$__r3f5 = instance.__r3f) == null ? void 0 : (_instance$__r3f5$root = _instance$__r3f5.root) == null ? void 0 : _instance$__r3f5$root.getState == null ? void 0 : _instance$__r3f5$root.getState();\n    if (state && state.internal.frames === 0) state.invalidate();\n  }\n\n  function updateInstance(instance) {\n    instance.onUpdate == null ? void 0 : instance.onUpdate(instance);\n  }\n\n  function createInstance(type, {\n    args = [],\n    ...props\n  }, root, hostContext, internalInstanceHandle) {\n    let name = `${type[0].toUpperCase()}${type.slice(1)}`;\n    let instance; // https://github.com/facebook/react/issues/17147\n    // Portals do not give us a root, they are themselves treated as a root by the reconciler\n    // In order to figure out the actual root we have to climb through fiber internals :(\n\n    if (!isStore(root) && internalInstanceHandle) {\n      const fn = node => {\n        if (!node.return) return node.stateNode && node.stateNode.containerInfo;else return fn(node.return);\n      };\n\n      root = fn(internalInstanceHandle);\n    } // Assert that by now we have a valid root\n\n\n    if (!root || !isStore(root)) throw `No valid root for ${name}!`;\n\n    if (type === 'primitive') {\n      if (props.object === undefined) throw `Primitives without 'object' are invalid!`;\n      const object = props.object;\n      instance = prepare(object, {\n        root,\n        primitive: true\n      });\n    } else {\n      const target = catalogue[name] || THREE[name];\n      if (!target) throw `${name} is not part of the THREE namespace! Did you forget to extend? See: https://github.com/pmndrs/react-three-fiber/blob/master/markdown/api.md#using-3rd-party-objects-declaratively`; // Instanciate new object, link it to the root\n      // Append memoized props with args so it's not forgotten\n\n      instance = prepare(new target(...args), {\n        root,\n        memoizedProps: {\n          args: args.length === 0 ? null : args\n        }\n      });\n    } // Auto-attach geometries and materials\n\n\n    if (!('attachFns' in props)) {\n      if (name.endsWith('Geometry')) {\n        props = {\n          attach: 'geometry',\n          ...props\n        };\n      } else if (name.endsWith('Material')) {\n        props = {\n          attach: 'material',\n          ...props\n        };\n      }\n    } // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n    // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n    // why it passes \"true\" here\n\n\n    applyProps(instance, props);\n    return instance;\n  }\n\n  function appendChild(parentInstance, child) {\n    let addedAsChild = false;\n\n    if (child) {\n      // The attach attribute implies that the object attaches itself on the parent\n      if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      } else if (child.attach && !is.fun(child.attach)) {\n        parentInstance[child.attach] = child;\n      } else if (is.arr(child.attachFns)) {\n        const [attachFn] = child.attachFns;\n\n        if (is.str(attachFn) && is.fun(parentInstance[attachFn])) {\n          parentInstance[attachFn](child);\n        } else if (is.fun(attachFn)) {\n          attachFn(child, parentInstance);\n        }\n      } else if (child.isObject3D && parentInstance.isObject3D) {\n        // add in the usual parent-child way\n        parentInstance.add(child);\n        addedAsChild = true;\n      }\n\n      if (!addedAsChild) {\n        // This is for anything that used attach, and for non-Object3Ds that don't get attached to props;\n        // that is, anything that's a child in React but not a child in the scenegraph.\n        parentInstance.__r3f.objects.push(child);\n      }\n\n      if (!child.__r3f) {\n        prepare(child, {});\n      }\n\n      child.__r3f.parent = parentInstance;\n      updateInstance(child);\n      invalidateInstance(child);\n    }\n  }\n\n  function insertBefore(parentInstance, child, beforeChild) {\n    let added = false;\n\n    if (child) {\n      if (child.attachArray) {\n        const array = parentInstance[child.attachArray];\n        if (!is.arr(array)) parentInstance[child.attachArray] = [];\n        array.splice(array.indexOf(beforeChild), 0, child);\n      } else if (child.attachObject || child.attach && !is.fun(child.attach)) {\n        // attach and attachObject don't have an order anyway, so just append\n        return appendChild(parentInstance, child);\n      } else if (child.isObject3D && parentInstance.isObject3D) {\n        child.parent = parentInstance;\n        child.dispatchEvent({\n          type: 'added'\n        });\n        const restSiblings = parentInstance.children.filter(sibling => sibling !== child);\n        const index = restSiblings.indexOf(beforeChild);\n        parentInstance.children = [...restSiblings.slice(0, index), child, ...restSiblings.slice(index)];\n        added = true;\n      }\n\n      if (!added) {\n        parentInstance.__r3f.objects.push(child);\n      }\n\n      if (!child.__r3f) {\n        prepare(child, {});\n      }\n\n      child.__r3f.parent = parentInstance;\n      updateInstance(child);\n      invalidateInstance(child);\n    }\n  }\n\n  function removeRecursive(array, parent, dispose = false) {\n    if (array) [...array].forEach(child => removeChild(parent, child, dispose));\n  }\n\n  function removeChild(parentInstance, child, dispose) {\n    if (child) {\n      var _parentInstance$__r3f, _child$__r3f2;\n\n      if (child.__r3f) {\n        child.__r3f.parent = null;\n      }\n\n      if ((_parentInstance$__r3f = parentInstance.__r3f) != null && _parentInstance$__r3f.objects) {\n        parentInstance.__r3f.objects = parentInstance.__r3f.objects.filter(x => x !== child);\n      } // Remove attachment\n\n\n      if (child.attachArray) {\n        parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(x => x !== child);\n      } else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      } else if (child.attach && !is.fun(child.attach)) {\n        parentInstance[child.attach] = null;\n      } else if (is.arr(child.attachFns)) {\n        const [, detachFn] = child.attachFns;\n\n        if (is.str(detachFn) && is.fun(parentInstance[detachFn])) {\n          parentInstance[detachFn](child);\n        } else if (is.fun(detachFn)) {\n          detachFn(child, parentInstance);\n        }\n      } else if (child.isObject3D) {\n        var _child$__r3f;\n\n        parentInstance.remove(child); // Remove interactivity\n\n        if ((_child$__r3f = child.__r3f) != null && _child$__r3f.root) {\n          removeInteractivity(child.__r3f.root, child);\n        }\n      } // Allow objects to bail out of recursive dispose alltogether by passing dispose={null}\n      // Never dispose of primitives because their state may be kept outside of React!\n      // In order for an object to be able to dispose it has to have\n      //   - a dispose method,\n      //   - it cannot be a <primitive object={...} />\n      //   - it cannot be a THREE.Scene, because three has broken it's own api\n      //\n      // Since disposal is recursive, we can check the optional dispose arg, which will be undefined\n      // when the reconciler calls it, but then carry our own check recursively\n\n\n      const isPrimitive = (_child$__r3f2 = child.__r3f) == null ? void 0 : _child$__r3f2.primitive;\n      const shouldDispose = dispose === undefined ? child.dispose !== null && !isPrimitive : dispose; // Remove nested child objects. Primitives should not have objects and children that are\n      // attached to them declaratively ...\n\n      if (!isPrimitive) {\n        var _child$__r3f3;\n\n        removeRecursive((_child$__r3f3 = child.__r3f) == null ? void 0 : _child$__r3f3.objects, child, shouldDispose);\n        removeRecursive(child.children, child, shouldDispose);\n      } // Remove references\n\n\n      if (child.__r3f) {\n        delete child.__r3f.root;\n        delete child.__r3f.objects;\n        delete child.__r3f.handlers;\n        delete child.__r3f.memoizedProps;\n        if (!isPrimitive) delete child.__r3f;\n      } // Dispose item whenever the reconciler feels like it\n\n\n      if (shouldDispose && child.dispose && child.type !== 'Scene') {\n        unstable_runWithPriority(unstable_IdlePriority, () => {\n          try {\n            child.dispose();\n          } catch (e) {\n            /* ... */\n          }\n        });\n      }\n\n      invalidateInstance(parentInstance);\n    }\n  }\n\n  function switchInstance(instance, type, newProps, fiber) {\n    var _instance$__r3f6;\n\n    const parent = (_instance$__r3f6 = instance.__r3f) == null ? void 0 : _instance$__r3f6.parent;\n    if (!parent) return;\n    const newInstance = createInstance(type, newProps, instance.__r3f.root); // https://github.com/pmndrs/react-three-fiber/issues/1348\n    // When args change the instance has to be re-constructed, which then\n    // forces r3f to re-parent the children and non-scene objects\n    // This can not include primitives, which should not have declarative children\n\n    if (type !== 'primitive' && instance.children) {\n      instance.children.forEach(child => appendChild(newInstance, child));\n      instance.children = [];\n    }\n\n    instance.__r3f.objects.forEach(child => appendChild(newInstance, child));\n\n    instance.__r3f.objects = [];\n    removeChild(parent, instance);\n    appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n    // https://github.com/facebook/react/issues/14983\n    // https://github.com/facebook/react/pull/15021\n    ;\n    [fiber, fiber.alternate].forEach(fiber => {\n      if (fiber !== null) {\n        fiber.stateNode = newInstance;\n\n        if (fiber.ref) {\n          if (typeof fiber.ref === 'function') fiber.ref(newInstance);else fiber.ref.current = newInstance;\n        }\n      }\n    });\n  }\n\n  const reconciler = Reconciler({\n    now: unstable_now,\n    createInstance,\n    removeChild,\n    appendChild,\n    appendInitialChild: appendChild,\n    insertBefore,\n    warnsIfNotActing: true,\n    supportsMutation: true,\n    isPrimaryRenderer: false,\n    // @ts-ignore\n    scheduleTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n    // @ts-ignore\n    cancelTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n    // @ts-ignore\n    setTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n    // @ts-ignore\n    clearTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n    noTimeout: -1,\n    appendChildToContainer: (parentInstance, child) => {\n      const {\n        container,\n        root\n      } = getContainer(parentInstance, child); // Link current root to the default scene\n\n      container.__r3f.root = root;\n      appendChild(container, child);\n    },\n    removeChildFromContainer: (parentInstance, child) => removeChild(getContainer(parentInstance, child).container, child),\n    insertInContainerBefore: (parentInstance, child, beforeChild) => insertBefore(getContainer(parentInstance, child).container, child, beforeChild),\n\n    prepareUpdate(instance, type, oldProps, newProps) {\n      if (instance.__r3f.primitive && newProps.object && newProps.object !== instance) return [true];else {\n        // This is a data object, let's extract critical information about it\n        const {\n          args: argsNew = [],\n          children: cN,\n          ...restNew\n        } = newProps;\n        const {\n          args: argsOld = [],\n          children: cO,\n          ...restOld\n        } = oldProps; // If it has new props or arguments, then it needs to be re-instanciated\n\n        if (argsNew.some((value, index) => value !== argsOld[index])) return [true]; // Create a diff-set, flag if there are any changes\n\n        const diff = diffProps(instance, restNew, restOld, true);\n        if (diff.changes.length) return [false, diff]; // Otherwise do not touch the instance\n\n        return null;\n      }\n    },\n\n    commitUpdate(instance, [reconstruct, diff], type, oldProps, newProps, fiber) {\n      // Reconstruct when args or <primitive object={...} have changes\n      if (reconstruct) switchInstance(instance, type, newProps, fiber); // Otherwise just overwrite props\n      else applyProps(instance, diff);\n    },\n\n    hideInstance(instance) {\n      if (instance.isObject3D) {\n        instance.visible = false;\n        invalidateInstance(instance);\n      }\n    },\n\n    unhideInstance(instance, props) {\n      if (instance.isObject3D && props.visible == null || props.visible) {\n        instance.visible = true;\n        invalidateInstance(instance);\n      }\n    },\n\n    hideTextInstance() {\n      throw new Error('Text is not allowed in the R3F tree.');\n    },\n\n    getPublicInstance(instance) {\n      // TODO: might fix switchInstance (?)\n      return instance;\n    },\n\n    getRootHostContext(rootContainer) {\n      return EMPTY;\n    },\n\n    getChildHostContext(parentHostContext) {\n      return parentHostContext;\n    },\n\n    createTextInstance() {},\n\n    finalizeInitialChildren() {\n      return false;\n    },\n\n    commitMount() {// noop\n    },\n\n    shouldDeprioritizeSubtree() {\n      return false;\n    },\n\n    prepareForCommit() {\n      return null;\n    },\n\n    preparePortalMount(containerInfo) {\n      prepare(containerInfo);\n    },\n\n    resetAfterCommit() {// noop\n    },\n\n    shouldSetTextContent() {\n      return false;\n    },\n\n    clearContainer() {\n      return false;\n    }\n\n  });\n  return {\n    reconciler,\n    applyProps\n  };\n}\n\nconst isRenderer = def => !!(def != null && def.render);\nconst isOrthographicCamera = def => def && def.isOrthographicCamera;\nfunction calculateDpr(dpr) {\n  return Array.isArray(dpr) ? Math.min(Math.max(dpr[0], window.devicePixelRatio), dpr[1]) : dpr;\n}\nconst context = /*#__PURE__*/React.createContext(null);\n\nconst createStore = (applyProps, invalidate, advance, props) => {\n  const {\n    gl,\n    size,\n    shadows = false,\n    linear = false,\n    flat = false,\n    vr = false,\n    orthographic = false,\n    frameloop = 'always',\n    dpr = 1,\n    performance,\n    clock = new THREE.Clock(),\n    raycaster: raycastOptions,\n    camera: cameraOptions,\n    onPointerMissed\n  } = props; // Set shadowmap\n\n  if (shadows) {\n    gl.shadowMap.enabled = true;\n    if (typeof shadows === 'object') Object.assign(gl.shadowMap, shadows);else gl.shadowMap.type = THREE.PCFSoftShadowMap;\n  } // Set color management\n\n\n  if (!linear) gl.outputEncoding = THREE.sRGBEncoding;\n  if (!flat) gl.toneMapping = THREE.ACESFilmicToneMapping; // clock.elapsedTime is updated using advance(timestamp)\n\n  if (frameloop === 'never') {\n    clock.stop();\n    clock.elapsedTime = 0;\n  }\n\n  const rootState = create((set, get) => {\n    // Create custom raycaster\n    const raycaster = new THREE.Raycaster();\n    const {\n      params,\n      ...options\n    } = raycastOptions || {};\n    applyProps(raycaster, {\n      enabled: true,\n      ...options,\n      params: { ...raycaster.params,\n        ...params\n      }\n    }); // Create default camera\n\n    const isCamera = cameraOptions instanceof THREE.Camera;\n    const camera = isCamera ? cameraOptions : orthographic ? new THREE.OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new THREE.PerspectiveCamera(75, 0, 0.1, 1000);\n\n    if (!isCamera) {\n      camera.position.z = 5;\n      if (cameraOptions) applyProps(camera, cameraOptions); // Always look at center by default\n\n      if (!(cameraOptions != null && cameraOptions.rotation)) camera.lookAt(0, 0, 0);\n    }\n\n    const initialDpr = calculateDpr(dpr);\n    const position = new THREE.Vector3();\n    const defaultTarget = new THREE.Vector3();\n    const tempTarget = new THREE.Vector3();\n\n    function getCurrentViewport(camera = get().camera, target = defaultTarget, size = get().size) {\n      const {\n        width,\n        height\n      } = size;\n      const aspect = width / height;\n      if (target instanceof THREE.Vector3) tempTarget.copy(target);else tempTarget.set(...target);\n      const distance = camera.getWorldPosition(position).distanceTo(tempTarget);\n\n      if (isOrthographicCamera(camera)) {\n        return {\n          width: width / camera.zoom,\n          height: height / camera.zoom,\n          factor: 1,\n          distance,\n          aspect\n        };\n      } else {\n        const fov = camera.fov * Math.PI / 180; // convert vertical fov to radians\n\n        const h = 2 * Math.tan(fov / 2) * distance; // visible height\n\n        const w = h * (width / height);\n        return {\n          width: w,\n          height: h,\n          factor: width / w,\n          distance,\n          aspect\n        };\n      }\n    }\n\n    let performanceTimeout = undefined;\n\n    const setPerformanceCurrent = current => set(state => ({\n      performance: { ...state.performance,\n        current\n      }\n    }));\n\n    return {\n      gl,\n      set,\n      get,\n      invalidate: () => invalidate(get()),\n      advance: (timestamp, runGlobalEffects) => advance(timestamp, runGlobalEffects, get()),\n      linear,\n      flat,\n      scene: prepare(new THREE.Scene()),\n      camera,\n      controls: null,\n      raycaster,\n      clock,\n      mouse: new THREE.Vector2(),\n      vr,\n      frameloop,\n      onPointerMissed,\n      performance: {\n        current: 1,\n        min: 0.5,\n        max: 1,\n        debounce: 200,\n        ...performance,\n        regress: () => {\n          const state = get(); // Clear timeout\n\n          if (performanceTimeout) clearTimeout(performanceTimeout); // Set lower bound performance\n\n          if (state.performance.current !== state.performance.min) setPerformanceCurrent(state.performance.min); // Go back to upper bound performance after a while unless something regresses meanwhile\n\n          performanceTimeout = setTimeout(() => setPerformanceCurrent(get().performance.max), state.performance.debounce);\n        }\n      },\n      size: {\n        width: 0,\n        height: 0\n      },\n      viewport: {\n        initialDpr,\n        dpr: initialDpr,\n        width: 0,\n        height: 0,\n        aspect: 0,\n        distance: 0,\n        factor: 0,\n        getCurrentViewport\n      },\n      setSize: (width, height) => {\n        const size = {\n          width,\n          height\n        };\n        set(state => ({\n          size,\n          viewport: { ...state.viewport,\n            ...getCurrentViewport(camera, defaultTarget, size)\n          }\n        }));\n      },\n      setDpr: dpr => set(state => ({\n        viewport: { ...state.viewport,\n          dpr: calculateDpr(dpr)\n        }\n      })),\n      events: {\n        connected: false\n      },\n      internal: {\n        active: false,\n        priority: 0,\n        frames: 0,\n        lastProps: props,\n        interaction: [],\n        hovered: new Map(),\n        subscribers: [],\n        initialClick: [0, 0],\n        initialHits: [],\n        capturedMap: new Map(),\n        subscribe: (ref, priority = 0) => {\n          set(({\n            internal\n          }) => ({\n            internal: { ...internal,\n              // If this subscription was given a priority, it takes rendering into its own hands\n              // For that reason we switch off automatic rendering and increase the manual flag\n              // As long as this flag is positive there can be no internal rendering at all\n              // because there could be multiple render subscriptions\n              priority: internal.priority + (priority > 0 ? 1 : 0),\n              // Register subscriber and sort layers from lowest to highest, meaning,\n              // highest priority renders last (on top of the other frames)\n              subscribers: [...internal.subscribers, {\n                ref,\n                priority\n              }].sort((a, b) => a.priority - b.priority)\n            }\n          }));\n          return () => {\n            set(({\n              internal\n            }) => ({\n              internal: { ...internal,\n                // Decrease manual flag if this subscription had a priority\n                priority: internal.priority - (priority > 0 ? 1 : 0),\n                // Remove subscriber from list\n                subscribers: internal.subscribers.filter(s => s.ref !== ref)\n              }\n            }));\n          };\n        }\n      }\n    };\n  }); // Resize camera and renderer on changes to size and pixelratio\n\n  rootState.subscribe(() => {\n    const {\n      camera,\n      size,\n      viewport,\n      internal\n    } = rootState.getState(); // https://github.com/pmndrs/react-three-fiber/issues/92\n    // Do not mess with the camera if it belongs to the user\n\n    if (!(internal.lastProps.camera instanceof THREE.Camera)) {\n      if (isOrthographicCamera(camera)) {\n        camera.left = size.width / -2;\n        camera.right = size.width / 2;\n        camera.top = size.height / 2;\n        camera.bottom = size.height / -2;\n      } else {\n        camera.aspect = size.width / size.height;\n      }\n\n      camera.updateProjectionMatrix(); // https://github.com/pmndrs/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      camera.updateMatrixWorld();\n    } // Update renderer\n\n\n    gl.setPixelRatio(viewport.dpr);\n    gl.setSize(size.width, size.height);\n  }, state => [state.viewport.dpr, state.size], shallow);\n  const state = rootState.getState(); // Update size\n\n  if (size) state.setSize(size.width, size.height); // Invalidate on any change\n\n  rootState.subscribe(state => invalidate(state)); // Return root state\n\n  return rootState;\n};\n\nfunction createSubs(callback, subs) {\n  const index = subs.length;\n  subs.push(callback);\n  return () => void subs.splice(index, 1);\n}\n\nlet i;\nlet globalEffects = [];\nlet globalAfterEffects = [];\nlet globalTailEffects = [];\nconst addEffect = callback => createSubs(callback, globalEffects);\nconst addAfterEffect = callback => createSubs(callback, globalAfterEffects);\nconst addTail = callback => createSubs(callback, globalTailEffects);\n\nfunction run(effects, timestamp) {\n  for (i = 0; i < effects.length; i++) effects[i](timestamp);\n}\n\nfunction render$1(timestamp, state) {\n  // Run local effects\n  let delta = state.clock.getDelta(); // In frameloop='never' mode, clock times are updated using the provided timestamp\n\n  if (state.frameloop === 'never' && typeof timestamp === 'number') {\n    delta = timestamp - state.clock.elapsedTime;\n    state.clock.oldTime = state.clock.elapsedTime;\n    state.clock.elapsedTime = timestamp;\n  } // Call subscribers (useFrame)\n\n\n  for (i = 0; i < state.internal.subscribers.length; i++) state.internal.subscribers[i].ref.current(state, delta); // Render content\n\n\n  if (!state.internal.priority && state.gl.render) state.gl.render(state.scene, state.camera); // Decrease frame count\n\n  state.internal.frames = Math.max(0, state.internal.frames - 1);\n  return state.frameloop === 'always' ? 1 : state.internal.frames;\n}\n\nfunction createLoop(roots) {\n  let running = false;\n  let repeat;\n\n  function loop(timestamp) {\n    running = true;\n    repeat = 0; // Run effects\n\n    run(globalEffects, timestamp); // Render all roots\n\n    roots.forEach(root => {\n      const state = root.store.getState(); // If the frameloop is invalidated, do not run another frame\n\n      if (state.internal.active && (state.frameloop === 'always' || state.internal.frames > 0)) repeat += render$1(timestamp, state);\n    }); // Run after-effects\n\n    run(globalAfterEffects, timestamp); // Keep on looping if anything invalidates the frameloop\n\n    if (repeat > 0) return requestAnimationFrame(loop); // Tail call effects, they are called when rendering stops\n    else run(globalTailEffects, timestamp); // Flag end of operation\n\n    running = false;\n  }\n\n  function invalidate(state) {\n    if (!state) return roots.forEach(root => invalidate(root.store.getState()));\n    if (state.vr || !state.internal.active || state.frameloop === 'never') return; // Increase frames, do not go higher than 60\n\n    state.internal.frames = Math.min(60, state.internal.frames + 1); // If the render-loop isn't active, start it\n\n    if (!running) {\n      running = true;\n      requestAnimationFrame(loop);\n    }\n  }\n\n  function advance(timestamp, runGlobalEffects = true, state) {\n    if (runGlobalEffects) run(globalEffects, timestamp);\n    if (!state) roots.forEach(root => render$1(timestamp, root.store.getState()));else render$1(timestamp, state);\n    if (runGlobalEffects) run(globalAfterEffects, timestamp);\n  }\n\n  return {\n    loop,\n    invalidate,\n    advance\n  };\n}\n\nfunction createPointerEvents(store) {\n  const {\n    handlePointer\n  } = createEvents(store);\n  const names = {\n    onClick: ['click', false],\n    onContextMenu: ['contextmenu', false],\n    onDoubleClick: ['dblclick', false],\n    onWheel: ['wheel', true],\n    onPointerDown: ['pointerdown', true],\n    onPointerUp: ['pointerup', true],\n    onPointerLeave: ['pointerleave', true],\n    onPointerMove: ['pointermove', true],\n    onPointerCancel: ['pointercancel', true],\n    onLostPointerCapture: ['lostpointercapture', true]\n  };\n  return {\n    connected: false,\n    handlers: Object.keys(names).reduce((acc, key) => ({ ...acc,\n      [key]: handlePointer(key)\n    }), {}),\n    connect: target => {\n      var _events$handlers;\n\n      const {\n        set,\n        events\n      } = store.getState();\n      events.disconnect == null ? void 0 : events.disconnect();\n      set(state => ({\n        events: { ...state.events,\n          connected: target\n        }\n      }));\n      Object.entries((_events$handlers = events == null ? void 0 : events.handlers) != null ? _events$handlers : []).forEach(([name, event]) => {\n        const [eventName, passive] = names[name];\n        target.addEventListener(eventName, event, {\n          passive\n        });\n      });\n    },\n    disconnect: () => {\n      const {\n        set,\n        events\n      } = store.getState();\n\n      if (events.connected) {\n        var _events$handlers2;\n\n        Object.entries((_events$handlers2 = events.handlers) != null ? _events$handlers2 : []).forEach(([name, event]) => {\n          if (events && events.connected instanceof HTMLElement) {\n            const [eventName] = names[name];\n            events.connected.removeEventListener(eventName, event);\n          }\n        });\n        set(state => ({\n          events: { ...state.events,\n            connected: false\n          }\n        }));\n      }\n    }\n  };\n}\n\n// React currently throws a warning when using useLayoutEffect on the server.\n// To get around it, we can conditionally useEffect on the server (no-op) and\n// useLayoutEffect in the browser.\nconst useIsomorphicLayoutEffect = typeof window !== 'undefined' ? React.useLayoutEffect : React.useEffect;\n\nfunction Block({\n  set\n}) {\n  useIsomorphicLayoutEffect(() => {\n    set(new Promise(() => null));\n    return () => set(false);\n  }, []);\n  return null;\n}\n\nclass ErrorBoundary extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      error: false\n    };\n  }\n\n  componentDidCatch(error) {\n    this.props.set(error);\n  }\n\n  render() {\n    return this.state.error ? null : this.props.children;\n  }\n\n}\n\nErrorBoundary.getDerivedStateFromError = () => ({\n  error: true\n});\n\nconst Canvas = /*#__PURE__*/React.forwardRef(function Canvas({\n  children,\n  fallback,\n  tabIndex,\n  resize,\n  id,\n  style,\n  className,\n  events,\n  ...props\n}, forwardedRef) {\n  const [containerRef, {\n    width,\n    height\n  }] = useMeasure({\n    scroll: true,\n    debounce: {\n      scroll: 50,\n      resize: 0\n    },\n    ...resize\n  });\n  const canvasRef = React.useRef(null);\n  const [block, setBlock] = React.useState(false);\n  const [error, setError] = React.useState(false); // Suspend this component if block is a promise (2nd run)\n\n  if (block) throw block; // Throw exception outwards if anything within canvas throws\n\n  if (error) throw error; // Execute JSX in the reconciler as a layout-effect\n\n  useIsomorphicLayoutEffect(() => {\n    if (width > 0 && height > 0) {\n      render( /*#__PURE__*/React.createElement(ErrorBoundary, {\n        set: setError\n      }, /*#__PURE__*/React.createElement(React.Suspense, {\n        fallback: /*#__PURE__*/React.createElement(Block, {\n          set: setBlock\n        })\n      }, children)), canvasRef.current, { ...props,\n        size: {\n          width,\n          height\n        },\n        events: events || createPointerEvents\n      });\n    }\n  }, [width, height, children]);\n  useIsomorphicLayoutEffect(() => {\n    const container = canvasRef.current;\n    return () => unmountComponentAtNode(container);\n  }, []);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    ref: containerRef,\n    id: id,\n    className: className,\n    tabIndex: tabIndex,\n    style: {\n      position: 'relative',\n      width: '100%',\n      height: '100%',\n      overflow: 'hidden',\n      ...style\n    }\n  }, /*#__PURE__*/React.createElement(\"canvas\", {\n    ref: mergeRefs([canvasRef, forwardedRef]),\n    style: {\n      display: 'block'\n    }\n  }, fallback));\n});\n\nfunction useStore() {\n  const store = React.useContext(context);\n  if (!store) throw `R3F hooks can only be used within the Canvas component!`;\n  return store;\n}\nfunction useThree(selector = state => state, equalityFn) {\n  return useStore()(selector, equalityFn);\n}\nfunction useFrame(callback, renderPriority = 0) {\n  const subscribe = useStore().getState().internal.subscribe; // Update ref\n\n  const ref = React.useRef(callback);\n  React.useLayoutEffect(() => void (ref.current = callback), [callback]); // Subscribe on mount, unsubscribe on unmount\n\n  React.useLayoutEffect(() => subscribe(ref, renderPriority), [renderPriority, subscribe]);\n  return null;\n}\n\nfunction buildGraph(object) {\n  const data = {\n    nodes: {},\n    materials: {}\n  };\n\n  if (object) {\n    object.traverse(obj => {\n      if (obj.name) {\n        data.nodes[obj.name] = obj;\n      }\n\n      if (obj.material && !data.materials[obj.material.name]) {\n        data.materials[obj.material.name] = obj.material;\n      }\n    });\n  }\n\n  return data;\n}\n\nfunction useGraph(object) {\n  return React.useMemo(() => buildGraph(object), [object]);\n}\n\nfunction loadingFn(extensions, onProgress) {\n  return function (Proto, ...input) {\n    // Construct new loader and run extensions\n    const loader = new Proto();\n    if (extensions) extensions(loader); // Go through the urls and load them\n\n    return Promise.all(input.map(input => new Promise((res, reject) => loader.load(input, data => {\n      if (data.scene) Object.assign(data, buildGraph(data.scene));\n      res(data);\n    }, onProgress, error => reject(`Could not load ${input}: ${error.message}`)))));\n  };\n}\n\nfunction useLoader(Proto, input, extensions, onProgress) {\n  // Use suspense to load async assets\n  const keys = Array.isArray(input) ? input : [input];\n  const results = useAsset(loadingFn(extensions, onProgress), Proto, ...keys); // Return the object/s\n\n  return Array.isArray(input) ? results : results[0];\n}\n\nuseLoader.preload = function (Proto, input, extensions) {\n  const keys = Array.isArray(input) ? input : [input];\n  return useAsset.preload(loadingFn(extensions), Proto, ...keys);\n};\n\nuseLoader.clear = function (Proto, input) {\n  const keys = Array.isArray(input) ? input : [input];\n  return useAsset.clear(Proto, ...keys);\n};\n\nconst roots = new Map();\nconst modes = ['legacy', 'blocking', 'concurrent'];\nconst {\n  invalidate,\n  advance\n} = createLoop(roots);\nconst {\n  reconciler,\n  applyProps\n} = createRenderer();\n\nconst createRendererInstance = (gl, canvas) => {\n  const customRenderer = typeof gl === 'function' ? gl(canvas) : gl;\n  if (isRenderer(customRenderer)) return customRenderer;\n  const renderer = new THREE.WebGLRenderer({\n    powerPreference: 'high-performance',\n    canvas: canvas,\n    antialias: true,\n    alpha: true,\n    ...gl\n  });\n  if (gl) applyProps(renderer, gl);\n  return renderer;\n};\n\nfunction render(element, canvas, {\n  gl,\n  size,\n  mode = modes[1],\n  events,\n  onCreated,\n  ...props\n} = {}) {\n  var _store;\n\n  // Allow size to take on container bounds initially\n  if (!size) {\n    var _canvas$parentElement, _canvas$parentElement2, _canvas$parentElement3, _canvas$parentElement4;\n\n    size = {\n      width: (_canvas$parentElement = (_canvas$parentElement2 = canvas.parentElement) == null ? void 0 : _canvas$parentElement2.clientWidth) != null ? _canvas$parentElement : 0,\n      height: (_canvas$parentElement3 = (_canvas$parentElement4 = canvas.parentElement) == null ? void 0 : _canvas$parentElement4.clientHeight) != null ? _canvas$parentElement3 : 0\n    };\n  }\n\n  let root = roots.get(canvas);\n  let fiber = root == null ? void 0 : root.fiber;\n  let store = root == null ? void 0 : root.store;\n  let state = (_store = store) == null ? void 0 : _store.getState();\n\n  if (fiber && state) {\n    // When a root was found, see if any fundamental props must be changed or exchanged\n    // Check pixelratio\n    if (props.dpr !== undefined && !is.equ(state.viewport.dpr, calculateDpr(props.dpr))) state.setDpr(props.dpr); // Check size\n\n    if (state.size.width !== size.width || state.size.height !== size.height) state.setSize(size.width, size.height); // For some props we want to reset the entire root\n    // Changes to the color-space\n\n    const linearChanged = props.linear !== state.internal.lastProps.linear;\n\n    if (linearChanged) {\n      unmountComponentAtNode(canvas);\n      fiber = undefined;\n    }\n  }\n\n  if (!fiber) {\n    // If no root has been found, make one\n    // Create gl\n    const glRenderer = createRendererInstance(gl, canvas); // Enable VR if requested\n\n    if (props.vr) {\n      glRenderer.xr.enabled = true;\n      glRenderer.setAnimationLoop(timestamp => advance(timestamp, true));\n    } // Create store\n\n\n    store = createStore(applyProps, invalidate, advance, {\n      gl: glRenderer,\n      size,\n      ...props\n    });\n    const state = store.getState(); // Create renderer\n\n    fiber = reconciler.createContainer(store, modes.indexOf(mode), false, null); // Map it\n\n    roots.set(canvas, {\n      fiber,\n      store\n    }); // Store events internally\n\n    if (events) state.set({\n      events: events(store)\n    });\n  }\n\n  if (store && fiber) {\n    reconciler.updateContainer( /*#__PURE__*/React.createElement(Provider, {\n      store: store,\n      element: element,\n      onCreated: onCreated,\n      target: canvas\n    }), fiber, null, () => undefined);\n    return store;\n  } else {\n    throw 'Error creating root!';\n  }\n}\n\nfunction Provider({\n  store,\n  element,\n  onCreated,\n  target\n}) {\n  React.useEffect(() => {\n    const state = store.getState(); // Flag the canvas active, rendering will now begin\n\n    state.set(state => ({\n      internal: { ...state.internal,\n        active: true\n      }\n    })); // Connect events\n\n    state.events.connect == null ? void 0 : state.events.connect(target); // Notifiy that init is completed, the scene graph exists, but nothing has yet rendered\n\n    if (onCreated) onCreated(state);\n  }, []);\n  return /*#__PURE__*/React.createElement(context.Provider, {\n    value: store\n  }, element);\n}\n\nfunction unmountComponentAtNode(canvas, callback) {\n  const root = roots.get(canvas);\n  const fiber = root == null ? void 0 : root.fiber;\n\n  if (fiber) {\n    const state = root == null ? void 0 : root.store.getState();\n    if (state) state.internal.active = false;\n    reconciler.updateContainer(null, fiber, null, () => {\n      if (state) {\n        setTimeout(() => {\n          var _state$gl, _state$gl$renderLists, _state$gl2;\n\n          state.events.disconnect == null ? void 0 : state.events.disconnect();\n          (_state$gl = state.gl) == null ? void 0 : (_state$gl$renderLists = _state$gl.renderLists) == null ? void 0 : _state$gl$renderLists.dispose == null ? void 0 : _state$gl$renderLists.dispose();\n          (_state$gl2 = state.gl) == null ? void 0 : _state$gl2.forceContextLoss == null ? void 0 : _state$gl2.forceContextLoss();\n          dispose(state);\n          roots.delete(canvas);\n          if (callback) callback(canvas);\n        }, 500);\n      }\n    });\n  }\n}\n\nfunction dispose(obj) {\n  if (obj.dispose && obj.type !== 'Scene') obj.dispose();\n\n  for (const p in obj) {\n    var _dispose, _ref;\n    (_dispose = (_ref = p).dispose) == null ? void 0 : _dispose.call(_ref);\n    delete obj[p];\n  }\n}\n\nconst act = reconciler.act;\n\nfunction createPortal(children, container) {\n  return reconciler.createPortal(children, container, null, null);\n}\n\nreconciler.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  rendererPackageName: '@react-three/fiber',\n  version: '17.0.2'\n});\n\nexport { Canvas, threeTypes as ReactThreeFiber, roots as _roots, act, addAfterEffect, addEffect, addTail, advance, applyProps, context, createPortal, dispose, createPointerEvents as events, extend, invalidate, reconciler, render, unmountComponentAtNode, useFrame, useGraph, useLoader, useStore, useThree };\n"]},"metadata":{},"sourceType":"module"}